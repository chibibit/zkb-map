{"version":3,"sources":["utils/scaling.ts","useKillmails.tsx","CameraControls.tsx","utils/theme.ts","utils/geometry.ts","Points.tsx","Stars.tsx","Flares.tsx","KillmailTicker.tsx","utils/formatting.ts","App.tsx","useSolarSytems.tsx","index.tsx","glow.png"],"names":["ageMultiplier","age","THREE","smoothstep","t","MAX_KILLMAIL_AGE_SEC","Math","pow","scaleValue","value","normalized","clamp","mapLinear","subscribeMessage","JSON","stringify","reduceKillmails","state","action","type","payload","killmail_id","killmail_time","victim","solar_system_id","zkb","killmail","id","time","parseISO","receivedAt","Date","characterId","character_id","corporationId","corporation_id","allianceId","alliance_id","shipTypeId","ship_type_id","solarSystemId","url","totalValue","scaledValue","uniqBy","now","filter","differenceInSeconds","extend","OrbitControls","CameraControls","useThree","camera","domElement","gl","controls","useRef","useFrame","_state","current","update","ref","args","theme","background","colorMaxSec","colorMinSec","flare","text","ThemeContext","React","createContext","buildAttributes","count","positions","Float32Array","colors","scales","setAttributes","geometry","setAttribute","attributes","position","needsUpdate","flareColor","size","tempVector","positionToArray","target","index","x","y","z","toArray","flareTexture","load","glow","uniforms","color","pointTexture","Points","forwardRef","_props","attach","vertexShader","fragmentShader","blending","depthTest","transparent","memo","solarSystems","pointsRef","useContext","useLayoutEffect","length","solarSystem","lerp","security","killmails","flares","differenceInMilliseconds","systemsWithKills","Object","keys","colorFlare","fade","keyframes","TickerContainer","styled","div","UNIT","EntryContainer","Data","ImageLink","a","area","Image","src","href","style","height","width","alt","KillmailEntry","name","billion","round","million","thousand","KillmailTicker","entries","map","km","key","GlobalStyle","createGlobalStyle","reset","cameraConfig","near","far","App","props","sourceUrl","useReducer","dispatch","useEffect","interval","setInterval","clearInterval","connection","WebSocket","onopen","send","onmessage","e","parse","data","close","useKillmails","useState","setSolarSystems","fetch","then","res","json","r","s","n","parseInt","radius","useSolarSystems","killmailsRef","solarSystemLookup","useMemo","keyBy","Provider","onCreated","setClearColor","ReactDOM","render","StrictMode","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.801a1cc6.chunk.js","sourcesContent":["import * as THREE from 'three'\n\nexport const MAX_KILLMAIL_AGE_SEC = 60\n\nconst fullyVisibleMs = 500\nconst fullyInvisibleMs = MAX_KILLMAIL_AGE_SEC * 1000\n\nexport const ageMultiplier = (age: number): number => {\n  if (age < fullyVisibleMs) {\n    return THREE.MathUtils.smoothstep(age, 0, fullyVisibleMs)\n  } else {\n    const t = THREE.MathUtils.smoothstep(age, fullyVisibleMs, fullyInvisibleMs) - 1\n    return Math.pow(t, 4)\n  }\n}\n\nconst minValueBound = 10_000\nconst maxValueBound = 100_000_000_000\nconst minValueMultiplier = 0.5\nconst maxValueMultiplier = 5\n\nexport const scaleValue = (value: number): number => {\n  const normalized = THREE.MathUtils.clamp(value, minValueBound, maxValueBound)\n  return THREE.MathUtils.mapLinear(normalized, minValueBound, maxValueBound, minValueMultiplier, maxValueMultiplier)\n}\n","import { useEffect, useReducer } from 'react'\nimport parseISO from 'date-fns/parseISO'\nimport differenceInSeconds from 'date-fns/differenceInSeconds'\nimport uniqBy from 'lodash/uniqBy'\nimport { scaleValue, MAX_KILLMAIL_AGE_SEC } from './utils/scaling'\n\nconst subscribeMessage = JSON.stringify({\n  \"action\": \"sub\",\n  \"channel\": \"killstream\"\n})\n\nconst decayIntervalMs = 10 * 1000\n\ntype UnparsedTimestamp = string\n\ninterface WebsocketKillmail {\n  killmail_id: number\n  killmail_time: UnparsedTimestamp\n  solar_system_id: number\n  victim: {\n    alliance_id?: number\n    character_id: number\n    corporation_id: number\n    ship_type_id: number\n    position: {\n      x: number,\n      y: number,\n      z: number\n    }\n  }\n  zkb: {\n    totalValue: number\n    fittedValue: number\n    locationID: number\n    npc: boolean\n    awox: boolean\n    solo: boolean\n    url: string\n  }\n}\n\nexport interface Killmail {\n  id: number\n  time: Date\n  receivedAt: Date\n  characterId: number\n  corporationId: number\n  allianceId?: number\n  shipTypeId: number\n  solarSystemId: number\n  url: string\n  totalValue: number\n  scaledValue: number\n}\n\ntype ReceiveWebsocketAction = {\n  type: 'RECEIVE_WEBSOCKET'\n  payload: WebsocketKillmail\n}\n\ntype DecayAction = {\n  type: 'DECAY'\n}\n\ntype KillmailAction = ReceiveWebsocketAction | DecayAction\n\nfunction reduceKillmails(state: Killmail[], action: KillmailAction): Killmail[] {\n  // console.log(action)\n  switch (action.type) {\n    case 'RECEIVE_WEBSOCKET': {\n      const { killmail_id, killmail_time, victim, solar_system_id, zkb } = action.payload\n\n      const time = parseISO(killmail_time)\n\n      const killmail: Killmail = {\n        id: killmail_id,\n        time,\n        receivedAt: new Date(),\n        characterId: victim.character_id,\n        corporationId: victim.corporation_id,\n        allianceId: victim.alliance_id,\n        shipTypeId: victim.ship_type_id,\n        solarSystemId: solar_system_id,\n        url: zkb.url,\n        totalValue: zkb.totalValue,\n        scaledValue: scaleValue(zkb.totalValue)\n      }\n\n      return uniqBy([killmail, ...state], 'id')\n    }\n    case 'DECAY': {\n      const now = new Date()\n      return state.filter(killmail => differenceInSeconds(now, killmail.receivedAt) < MAX_KILLMAIL_AGE_SEC)\n    }\n    default:\n      return state\n  }\n}\n\nexport function useKillmails(props: { sourceUrl: string }): Killmail[] {\n  const { sourceUrl } = props\n  const [killmails, dispatch] = useReducer(reduceKillmails, [])\n\n  useEffect(() => {\n    const interval = setInterval(() => dispatch({ type: 'DECAY' }), decayIntervalMs)\n    return () => clearInterval(interval)\n  }, [dispatch])\n\n  useEffect(() => {\n    const connection = new WebSocket(sourceUrl)\n\n    connection.onopen = () => {\n      connection.send(subscribeMessage)\n    }\n\n    connection.onmessage = (e) => {\n      const killmail: WebsocketKillmail = JSON.parse(e.data)\n      dispatch({ type: 'RECEIVE_WEBSOCKET', payload: killmail })\n    }\n\n    return () => connection.close()\n  }, [sourceUrl, dispatch])\n\n  return killmails\n}\n","import React, {  useRef } from 'react'\nimport { useFrame, extend, useThree } from 'react-three-fiber'\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\"\n\nextend({ OrbitControls })\n\ndeclare global {\n  namespace JSX {\n    interface IntrinsicElements {\n      orbitControls: React.DetailedHTMLProps<any, any>\n    }\n  }\n}\n\nexport const CameraControls: React.FC<{}> = () => {\n  const { camera, gl: { domElement } } = useThree()\n  const controls = useRef<OrbitControls>()\n  useFrame(_state => controls.current?.update())\n  return <orbitControls ref={controls} args={[camera, domElement]} />;\n};\n","import React from 'react'\n\nexport const theme = {\n  background: '#060606',\n  colorMaxSec: '#2A9FD6',\n  colorMinSec: '#E6E6E6',\n  flare: '#E60000',\n  text: '#E6E6E6'\n}\n\nexport const ThemeContext = React.createContext(theme)\n","import * as THREE from 'three'\n\nexport const buildAttributes = (count: number) => ({\n  positions: new Float32Array(count * 3),\n  colors: new Float32Array(count * 3),\n  scales: new Float32Array(count)\n})\n\nexport const setAttributes = (geometry: THREE.BufferGeometry, positions: Float32Array, colors: Float32Array, scales: Float32Array) => {\n  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))\n  geometry.setAttribute('flareColor', new THREE.BufferAttribute(colors, 3))\n  geometry.setAttribute('size', new THREE.BufferAttribute(scales, 1))\n\n  geometry.attributes.position.needsUpdate = true\n  geometry.attributes.flareColor.needsUpdate = true\n  geometry.attributes.size.needsUpdate = true\n}\n\ninterface HasPosition {\n x: number\n y: number\n z: number\n}\n\nconst tempVector = new THREE.Vector3()\nexport const positionToArray = ({ x, y, z }: HasPosition, target: Float32Array, index: number): void => {\n  tempVector.x = x\n  tempVector.y = y\n  tempVector.z = z\n  tempVector.toArray(target, index * 3)\n}\n\n","import React, { forwardRef } from 'react'\nimport * as THREE from 'three'\nimport glow from './glow.png'\n\nconst VERTEX_SHADER = `\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n`\n\nconst FRAGMENT_SHADER = `\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n`\n\nconst flareTexture = new THREE.TextureLoader().load(glow)\n\nconst uniforms = {\n  color: { value: new THREE.Color() },\n  pointTexture: { value: flareTexture }\n}\n\nconst Points = forwardRef((_props, ref) => <points ref={ref as any}>\n  <bufferGeometry attach='geometry' />\n  <shaderMaterial\n    uniforms={uniforms}\n    vertexShader={VERTEX_SHADER}\n    fragmentShader={FRAGMENT_SHADER}\n    blending={THREE.AdditiveBlending}\n    depthTest={false}\n    transparent={true}\n    attach='material'\n  />\n</points>)\n\nexport default Points\n","import React, { useRef, useLayoutEffect, useContext } from 'react'\nimport { SolarSystem } from './useSolarSytems'\nimport * as THREE from 'three'\nimport { buildAttributes, setAttributes, positionToArray } from './utils/geometry'\nimport Points from './Points'\nimport { ThemeContext } from './utils/theme'\n\nconst systemSize = 5\n\nconst Stars: React.FC<{\n  solarSystems: SolarSystem[]\n}> = ({ solarSystems }) => {\n  const pointsRef = useRef<THREE.Points>()\n\n  const theme = useContext(ThemeContext)\n\n  useLayoutEffect(() => {\n    if (!pointsRef.current) {\n      return\n    }\n\n    const colorMaxSec = new THREE.Color(theme.colorMaxSec)\n\n    const count = solarSystems.length\n\n    const { positions, colors, scales } = buildAttributes(count)\n\n    for (let index = 0; index < count; index++) {\n      const solarSystem = solarSystems[index]\n\n      positionToArray(solarSystem, positions, index)\n\n      new THREE.Color(theme.colorMinSec).lerp(colorMaxSec, solarSystem.security).toArray(colors, index * 3)\n\n      scales[index] = systemSize\n    }\n\n    setAttributes(pointsRef.current.geometry as THREE.BufferGeometry, positions, colors, scales)\n  }, [solarSystems, solarSystems.length, theme])\n\n  return <Points ref={pointsRef} />\n}\n\nexport default React.memo(Stars)\n","import React, { useRef, useContext } from 'react'\nimport { useFrame } from 'react-three-fiber'\nimport { SolarSystem } from './useSolarSytems'\nimport * as THREE from 'three'\nimport { Killmail } from './useKillmails'\nimport differenceInMilliseconds from 'date-fns/differenceInMilliseconds'\nimport { ageMultiplier } from './utils/scaling'\nimport { buildAttributes, setAttributes, positionToArray } from './utils/geometry'\nimport Points from './Points'\nimport { ThemeContext } from './utils/theme'\n\nconst baseFlareSize = 150\nconst maxFlareSize = 1000\n\nconst Flares: React.FC<{\n  solarSystems: Record<string, SolarSystem>\n  killmails: React.MutableRefObject<Killmail[]>\n}> = ({ solarSystems, killmails }) => {\n  const pointsRef = useRef<THREE.Points>()\n\n  const theme = useContext(ThemeContext)\n\n  useFrame(() => {\n    if (!killmails.current || !pointsRef.current) {\n      return\n    }\n\n    const flares: Record<string, number> = {}\n\n    const now = new Date()\n\n    for (let index = 0; index < killmails.current.length; index++) {\n      const { receivedAt, solarSystemId, scaledValue } = killmails.current[index]\n\n      const age = differenceInMilliseconds(now, receivedAt)\n      const value = baseFlareSize * scaledValue * ageMultiplier(age)\n\n      flares[solarSystemId] = THREE.MathUtils.clamp((flares[solarSystemId] || 0) + value, 0, maxFlareSize)\n    }\n\n    const systemsWithKills = Object.keys(flares)\n    const count = systemsWithKills.length\n\n    const { positions, colors, scales } = buildAttributes(count)\n\n    const colorFlare = new THREE.Color(theme.flare)\n\n    for (let index = 0; index < count; index++) {\n      const solarSystemId = systemsWithKills[index]\n      const solarSystem = solarSystems[solarSystemId] || {}\n\n      positionToArray(solarSystem, positions, index)\n\n      colorFlare.toArray(colors, index * 3)\n      scales[index] = flares[solarSystemId]\n    }\n\n    setAttributes(pointsRef.current.geometry as THREE.BufferGeometry, positions, colors, scales)\n  })\n\n  return <Points ref={pointsRef} />\n}\n\nexport default React.memo(Flares)\n","import React from 'react'\nimport { Killmail } from './useKillmails'\nimport styled, { keyframes } from 'styled-components'\nimport { SolarSystem } from './useSolarSytems'\nimport { theme } from './utils/theme'\nimport { MAX_KILLMAIL_AGE_SEC } from './utils/scaling'\nimport { stringifyPrice } from './utils/formatting'\n\nconst UNIT = 32\n\n// 50%, because MAX_KILLMAIL_AGE_SEC is not a guaranteed removal\nconst fade = keyframes`\n  0% { opacity: 1; }\n  10% { opacity: 0.9; }\n  50% { opacity: 0; }\n  100% { opacity: 0; }\n`\n\nconst TickerContainer = styled.div`\n  position: absolute;\n  top: ${UNIT / 2}px;\n  left: ${UNIT / 2}px;\n  overflow: hidden;\n  max-height: calc(100vh - ${UNIT}px);\n`\n\nconst EntryContainer = styled.div`\n  display: grid;\n  grid-template-areas: \"ship character corporation alliance\"\n                       \"ship data      data        data\";\n  grid-template-columns: ${UNIT * 2}px ${UNIT}px ${UNIT}px 1fr;\n  grid-template-rows: repeat(2, ${UNIT}px);\n  grid-gap: ${UNIT / 8}px;\n  animation: ${fade} ${MAX_KILLMAIL_AGE_SEC * 2}s linear;\n`\n\nconst Data = styled.div`\n  grid-area: data;\n  color: ${theme.text};\n`\n\nconst ImageLink = styled.a<{ area: string }>`\n  grid-area: ${({ area }) => area};\n  text-decoration: none;\n`\n\nconst Image: React.FC<{\n  src: string\n  area: string\n  size: number\n  href?: string\n}> = ({ src, area, size, href }) => {\n  return <ImageLink href={href} area={area} target='_blank'>\n    <img\n      src={`${src}?size=${size}`}\n      style={{ height: size, width: size }}\n      alt=''\n    />\n  </ImageLink>\n}\n\nconst KillmailEntry: React.FC<{\n  killmail: Killmail\n  solarSystem: SolarSystem\n}> = ({ killmail, solarSystem }) => {\n  const { name } = solarSystem\n  const { characterId, corporationId, allianceId, shipTypeId, totalValue, url } = killmail\n\n  return <EntryContainer>\n    {shipTypeId && <Image\n      src={`https://images.evetech.net/types/${shipTypeId}/render`}\n      area='ship'\n      size={UNIT * 2}\n      href={url}\n    />}\n    {characterId && <Image\n      src={`https://images.evetech.net/characters/${characterId}/portrait`}\n      area='character'\n      size={UNIT}\n      href={`https://zkillboard.com/character/${characterId}/`}\n    />}\n    {corporationId && <Image\n      src={`https://images.evetech.net/corporations/${corporationId}/logo`}\n      area='corporation'\n      size={UNIT}\n      href={`https://zkillboard.com/corporation/${corporationId}/`}\n    />}\n    {allianceId && <Image\n      src={`https://images.evetech.net/alliances/${allianceId}/logo`}\n      area='alliance'\n      size={UNIT}\n      href={`https://zkillboard.com/alliance/${allianceId}/`}\n    />}\n\n    <Data>\n      {stringifyPrice(totalValue)} @ {name}\n    </Data>\n  </EntryContainer>\n}\n\nconst KillmailTicker: React.FC<{\n  killmails: Killmail[]\n  solarSystems: Record<number, SolarSystem>\n}> = ({ killmails, solarSystems }) => {\n  const entries = killmails.map(km => {\n    const { id, solarSystemId } = km\n    const solarSystem = solarSystems[solarSystemId]\n\n    return solarSystem ? <KillmailEntry killmail={km} solarSystem={solarSystem} key={id} /> : null\n  })\n\n  return <TickerContainer>\n    {entries}\n  </TickerContainer>\n}\n\nexport default KillmailTicker\n","import round from 'lodash/round'\n\nconst thousand = 1_000\nconst million = thousand * thousand\nconst billion = million * thousand\nconst precision = 1\n\nconst displayBillionsFrom = billion / 2\nconst displayMillionsFrom = million / 2\n\nexport const stringifyPrice = (value: number): string => {\n  if (value > displayBillionsFrom) {\n    return `${round(value / billion, precision)}b`\n  } else if (value > displayMillionsFrom) {\n    return `${round(value / million, precision)}m`\n  } else {\n    return `${round(value / thousand, precision)}k`\n  }\n}\n","import React, { useRef, useEffect, useMemo } from 'react'\nimport { useKillmails } from './useKillmails'\nimport { useSolarSystems } from './useSolarSytems'\nimport { createGlobalStyle } from 'styled-components'\nimport reset from 'styled-reset'\nimport { Canvas } from 'react-three-fiber'\nimport * as THREE from 'three'\nimport { CameraControls } from './CameraControls'\nimport { theme, ThemeContext } from './utils/theme'\nimport Stars from './Stars'\nimport Flares from './Flares'\nimport { Stats } from 'drei'\nimport keyBy from 'lodash/keyBy'\nimport KillmailTicker from './KillmailTicker'\n\nconst GlobalStyle = createGlobalStyle`\n  ${reset}\n\n  #root {\n    height: 100vh;\n    background: ${theme.background};\n    overflow: hidden;\n  }\n`\n\nconst cameraConfig  = {\n  position: new THREE.Vector3(0, 0, 1_000),\n  near: 0.001,\n  far: 10_000\n}\n\nconst App: React.FC<{}> = () => {\n  const sourceUrl = 'wss://zkillboard.com/websocket/'\n  const killmails = useKillmails({ sourceUrl })\n  const solarSystems = useSolarSystems()\n  const killmailsRef = useRef<typeof killmails>([])\n\n  const solarSystemLookup = useMemo(() => keyBy(solarSystems, 'id'), [solarSystems])\n\n  useEffect(() => {\n    killmailsRef.current = killmails\n  }, [killmails])\n\n  return <ThemeContext.Provider value={theme}>\n    <GlobalStyle />\n\n    <Canvas camera={cameraConfig} onCreated={({ gl }) => gl.setClearColor(theme.background)}>\n      {/* <Stats /> */}\n\n      <ambientLight />\n\n      <Stars solarSystems={solarSystems} />\n      <Flares solarSystems={solarSystemLookup} killmails={killmailsRef} />\n\n      <CameraControls />\n    </Canvas>\n\n    <KillmailTicker killmails={killmails} solarSystems={solarSystemLookup} />\n  </ThemeContext.Provider>\n}\n\nexport default App;\n","import { useEffect, useState } from 'react'\n\nexport interface SolarSystem {\n  id: number\n  name: string\n  x: number\n  y: number\n  z: number\n  radius: number\n  security: number\n}\n\ninterface RawSolarSystem {\n  x: number\n  y: number\n  z: number\n  r: number\n  s: number\n  n: string\n}\n\nexport function useSolarSystems(): SolarSystem[] {\n  const [solarSystems, setSolarSystems] = useState<SolarSystem[]>([])\n\n  useEffect(() => {\n    fetch('data/solarSystems.json').then(res => res.json()).then((data: Record<string, RawSolarSystem>) => {\n      const solarSystems = Object.entries(data).map(([id, { x, y, z, r, s, n }]) => {\n        return {\n          id: parseInt(id),\n          x,\n          y: z,\n          z: y,\n          name: n,\n          radius: r,\n          security: s\n        } as SolarSystem\n      })\n\n      setSolarSystems(solarSystems)\n    })\n  }, [])\n\n  return solarSystems\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n","module.exports = __webpack_public_path__ + \"static/media/glow.3b6b0c75.png\";"],"sourceRoot":""}
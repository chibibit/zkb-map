(this["webpackJsonpzkb-map"]=this["webpackJsonpzkb-map"]||[]).push([[0],{131:function(e,t,r){e.exports=r.p+"static/media/glow.3b6b0c75.png"},145:function(e,t,r){e.exports=r(262)},262:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),o=r(28),c=r.n(o),i=r(27),l=r(126),s=r(0),u=r(4),m=function(e){if(e<500)return s.MathUtils.smoothstep(e,0,500);var t=s.MathUtils.smoothstep(e,500,6e4)-1;return Math.pow(t,4)},f=function(e){var t=s.MathUtils.clamp(e,1e4,1e10);return s.MathUtils.mapLinear(t,1e4,1e10,1,10)},d=function(){var e=Object(u.h)().size,t=e.height,r=e.width;return Math.min(t,r)},p=r(34),v=r(56),b=r(19),h=r(16),g=r.n(h),y=r(29),j=r(123),O=r.n(j),E=r(124),x=r.n(E),k=Object(p.b)("solarSystems/fetch",Object(y.a)(g.a.mark((function e(){var t,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://tmikoss.github.io/zkb-map/data/solarSystems.json");case 2:return t=e.sent,e.next=5,t.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))),w=Object(p.c)({name:"solarSystems",initialState:{},reducers:{},extraReducers:function(e){e.addCase(k.fulfilled,(function(e,t){var r=t.payload;O()(r,(function(t,r){var n=t.x,a=t.y,o=t.z,c=t.n,i=t.r,l=t.s;e[r]={id:parseInt(r),x:n,y:o,z:a,name:c,radius:x()(100*i,.75,1.25),security:l}}))}))}}).reducer,S=r(125),C=r.n(S),z=r(141),A=Object(p.c)({name:"killmails",initialState:{},reducers:{receiveKillmail:function(e,t){var r=t.payload;e[r.id]=r},trimKillmailsBefore:function(e,t){var r=Object(z.a)(new Date,t.payload);return C()(e,(function(e){return e.receivedAt>r}))}}}),_=A.actions,I=_.receiveKillmail,M=_.trimKillmailsBefore,P=A.reducer,V=Object(b.c)({solarSystems:w,killmails:P}),T=Object(p.a)({reducer:V,middleware:Object(p.d)({serializableCheck:{ignoredActionPaths:["payload.time","payload.receivedAt"],ignoredPaths:["killmails"]},immutableCheck:!1})}),B=function(){return Object(v.b)()},D=v.c,F=T,U=JSON.stringify({action:"sub",channel:"killstream"});function R(e){var t=B();Object(n.useEffect)((function(){var e=setInterval((function(){t(M(60))}),1e4);return function(){return clearInterval(e)}}),[t]),Object(n.useEffect)((function(){var r=new WebSocket(e);return r.onopen=function(){r.send(U)},r.onmessage=function(e){t(I(function(e){var t=e.killmail_id,r=e.killmail_time,n=e.victim,a=e.solar_system_id,o=e.zkb;return{id:t,time:Object(l.a)(r),receivedAt:new Date,characterId:n.character_id,corporationId:n.corporation_id,allianceId:n.alliance_id,shipTypeId:n.ship_type_id,solarSystemId:a,url:o.url,totalValue:o.totalValue,scaledValue:f(o.totalValue)}}(JSON.parse(e.data))))},function(){return r.close()}}),[e,t])}var J=r(20),K=r(127),L=r(55);Object(u.e)({OrbitControls:L.b});var N=function(){var e=Object(u.h)(),t=e.camera,r=e.gl.domElement,o=Object(n.useRef)();return Object(u.f)((function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.update()})),a.a.createElement("orbitControls",{ref:o,args:[t,r]})},G={background:"#060606",colorMaxSec:"#2A9FD6",colorMinSec:"#E6E6E6",flare:"#E60000",text:"#E6E6E6"},W=a.a.createContext(G),q=function(e){return{positions:new Float32Array(3*e),colors:new Float32Array(3*e),scales:new Float32Array(e)}},H=function(e,t,r,n){e.setAttribute("position",new s.BufferAttribute(t,3)),e.setAttribute("flareColor",new s.BufferAttribute(r,3)),e.setAttribute("size",new s.BufferAttribute(n,1)),e.attributes.position.needsUpdate=!0,e.attributes.flareColor.needsUpdate=!0,e.attributes.size.needsUpdate=!0},Q=new s.Vector3,X=function(e,t,r){var n=e.x,a=e.y,o=e.z;Q.x=n,Q.y=a,Q.z=o,Q.toArray(t,3*r)},Y=r(131),Z=r.n(Y),$=(new s.TextureLoader).load(Z.a),ee={color:{value:new s.Color},pointTexture:{value:$}},te=Object(n.forwardRef)((function(e,t){return a.a.createElement("points",{ref:t},a.a.createElement("bufferGeometry",{attach:"geometry"}),a.a.createElement("shaderMaterial",{uniforms:ee,vertexShader:"\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n",blending:s.AdditiveBlending,depthTest:!1,transparent:!0,attach:"material"}))})),re=a.a.memo((function(e){var t=e.solarSystems,r=Object(n.useRef)(),o=Object(n.useContext)(W),c=d();return Object(u.f)((function(){if(r.current){for(var e=new s.Color(o.colorMaxSec),n=Object.values(t),a=n.length,i=c/75,l=q(a),u=l.positions,m=l.colors,f=l.scales,d=0;d<a;d++){var p=n[d];X(p,u,d),new s.Color(o.colorMinSec).lerp(e,p.security).toArray(m,3*d),f[d]=i*p.radius}H(r.current.geometry,u,m,f)}})),a.a.createElement(te,{ref:r})})),ne=r(132),ae=a.a.memo((function(e){var t=e.solarSystems,r=e.killmails,o=Object(n.useRef)(),c=Object(n.useContext)(W),i=d();return Object(u.f)((function(){if(r.current&&o.current){for(var e=r.current.length,n=new Date,a=i/8,l=new s.Color(c.flare),u=q(e),f=u.positions,d=u.colors,p=u.scales,v=0;v<r.current.length;v++){var b=r.current[v],h=b.receivedAt,g=b.solarSystemId,y=b.scaledValue,j=t[g]||{},O=Object(ne.a)(n,h);p[v]=a*y*m(O),X(j,f,v),l.toArray(d,3*v)}H(o.current.geometry,f,d,p)}})),a.a.createElement(te,{ref:o})})),oe=r(74),ce=r.n(oe),ie=r(85),le=r.n(ie),se=r(133),ue=r.n(se);function me(){var e=Object(i.a)(["\n  grid-area: ",";\n  text-decoration: none;\n"]);return me=function(){return e},e}function fe(){var e=Object(i.a)(["\n  grid-area: data;\n  color: ",";\n"]);return fe=function(){return e},e}function de(){var e=Object(i.a)(['\n  display: grid;\n  grid-template-areas: "ship character corporation alliance"\n                       "ship data      data        data";\n  grid-template-columns: ',"px ","px ","px 1fr;\n  grid-template-rows: repeat(2, ","px);\n  grid-gap: ","px;\n  animation: "," ","s linear;\n"]);return de=function(){return e},e}function pe(){var e=Object(i.a)(["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  overflow: hidden;\n  max-height: calc(100vh - ","px);\n"]);return pe=function(){return e},e}function ve(){var e=Object(i.a)(["\n  0% { opacity: 0; }\n  0.5% { opacity: 1; }\n  10% { opacity: 0.9; }\n  50% { opacity: 0; }\n  100% { opacity: 0; }\n"]);return ve=function(){return e},e}var be=Object(J.d)(ve()),he=J.c.div(pe(),16,16,32),ge=J.c.div(de(),64,32,32,32,4,be,120),ye=J.c.div(fe(),G.text),je=J.c.a(me(),(function(e){return e.area})),Oe=function(e){var t=e.src,r=e.area,n=e.size,o=e.href;return a.a.createElement(je,{href:o,area:r,target:"_blank"},a.a.createElement("img",{src:"".concat(t,"?size=").concat(n),style:{height:n,width:n},alt:""}))},Ee=function(e){var t=e.killmail,r=e.solarSystem;if(!r)return null;var n,o=r.name,c=t.characterId,i=t.corporationId,l=t.allianceId,s=t.shipTypeId,u=t.totalValue,m=t.url;return a.a.createElement(ge,null,s&&a.a.createElement(Oe,{src:"https://images.evetech.net/types/".concat(s,"/render"),area:"ship",size:64,href:m}),c&&a.a.createElement(Oe,{src:"https://images.evetech.net/characters/".concat(c,"/portrait"),area:"character",size:32,href:"https://zkillboard.com/character/".concat(c,"/")}),i&&a.a.createElement(Oe,{src:"https://images.evetech.net/corporations/".concat(i,"/logo"),area:"corporation",size:32,href:"https://zkillboard.com/corporation/".concat(i,"/")}),l&&a.a.createElement(Oe,{src:"https://images.evetech.net/alliances/".concat(l,"/logo"),area:"alliance",size:32,href:"https://zkillboard.com/alliance/".concat(l,"/")}),a.a.createElement(ye,null,(n=u)>5e8?"".concat(ce()(n/1e9,1),"b"):n>5e5?"".concat(ce()(n/1e6,1),"m"):"".concat(ce()(n/1e3,1),"k")," @ ",o))},xe=function(e){var t=e.killmails,r=e.solarSystems,n=ue()(le()(t),"receivedAt").reverse().map((function(e){var t=e.id,n=e.solarSystemId,o=r[n];return a.a.createElement(Ee,{killmail:e,solarSystem:o,key:t})}));return a.a.createElement(he,null,n)};r(5),r(140),r(36),r(134);function ke(){var e=Object(i.a)(["\n  position: absolute;\n  top: 1vh;\n  right: 1vw;\n  color: ",";\n  display: flex;\n  flex-flow: column;\n  gap: 1vh;\n"]);return ke=function(){return e},e}J.c.div(ke(),G.text),(new Date).getTime();function we(){var e=Object(i.a)(["\n  ","\n\n  #root {\n    height: 100vh;\n    background: ",";\n    overflow: hidden;\n  }\n\n  canvas {\n    outline: 0;\n  }\n"]);return we=function(){return e},e}var Se,Ce=Object(J.a)(we(),K.a,G.background),ze={position:new s.Vector3(0,0,1e3),near:.001,far:1e4};Se=function(){var e=B();R("wss://zkillboard.com/websocket/"),Object(n.useEffect)((function(){e(k())}),[e]);var t=Object(n.useRef)([]),r=D((function(e){return e.solarSystems})),o=D((function(e){return e.killmails}));return Object(n.useEffect)((function(){t.current=Object.values(o)}),[o]),a.a.createElement(W.Provider,{value:G},a.a.createElement(Ce,null),a.a.createElement(u.a,{camera:ze,onCreated:function(e){return e.gl.setClearColor(G.background)}},a.a.createElement("ambientLight",null),a.a.createElement(re,{solarSystems:r}),a.a.createElement(ae,{solarSystems:r,killmails:t}),a.a.createElement(N,null)),a.a.createElement(xe,{killmails:o,solarSystems:r}),!1)},c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(v.a,{store:F},a.a.createElement(Se,null))),document.getElementById("root"))}},[[145,1,2]]]);
//# sourceMappingURL=main.34d3ad0a.chunk.js.map
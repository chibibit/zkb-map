(this["webpackJsonpzkb-map"]=this["webpackJsonpzkb-map"]||[]).push([[0],{142:function(e,t,n){e.exports=n.p+"static/media/glow.3b6b0c75.png"},153:function(e,t,n){e.exports=n(273)},273:function(e,t,n){"use strict";n.r(t);var r,a=n(1),o=n.n(a),c=n(32),i=n.n(c),l=n(25),u=n(34),s=n(135),f=n(0),m=n(9),d=function(e,t){if(e<500)return f.MathUtils.smoothstep(e,0,500);var n=45e3*t,r=f.MathUtils.smoothstep(e,500,n)-1;return Math.pow(r,4)},v=function(e){var t=f.MathUtils.clamp(e,1e4,1e10);return f.MathUtils.mapLinear(t,1e4,1e10,1,10)},p=function(){var e=Object(m.g)().size,t=e.height,n=e.width;return Math.min(t,n)},h=n(27),b=n(61),g=n(24),j=n(22),O=n.n(j),y=n(35),E=n(131),w=n.n(E),k=n(132),x=n.n(k),S=Object(h.b)("solarSystems/fetch",Object(y.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://tmikoss.github.io/zkb-map/data/solarSystems.json");case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))),C=Object(h.c)({name:"solarSystems",initialState:{},reducers:{},extraReducers:function(e){e.addCase(S.fulfilled,(function(e,t){var n=t.payload;w()(n,(function(t,n){var r=t.x,a=t.y,o=t.z,c=t.n,i=t.r,l=t.s;e[n]={id:parseInt(n),x:r,y:o,z:a,name:c,radius:x()(100*i,.5,1.5),security:l}}))}))}}).reducer,z=n(133),A=n.n(z),M=n(26),I=function(e,t,n){var r=e.scaledValue,a=e.receivedAt;return Object(M.a)(t,a)<n*r},_=Object(h.c)({name:"killmails",initialState:{},reducers:{receiveKillmail:function(e,t){var n=t.payload,r=n.killmail,a=n.normalAge;I(r,new Date,a)&&(e[r.id]=r)},trimKillmails:function(e,t){var n=new Date,r=t.payload;return A()(e,(function(e){return I(e,n,r)}))}}}),D=_.actions,F=D.receiveKillmail,R=D.trimKillmails,B=_.reducer,V={connected:!1,pingReceived:void 0},P=Object(h.c)({name:"connection",initialState:V,reducers:{receivePing:function(e){e.connected=!0,e.pingReceived=new Date},checkConnection:function(e){e.connected=!!e.pingReceived&&Object(M.a)(new Date,e.pingReceived)<15e3}}}),T=P.actions,U=T.receivePing,q=T.checkConnection,J=P.reducer;!function(e){e[e.full=0]="full",e[e.follow=1]="follow"}(r||(r={}));var K={cameraMode:r.follow},G=Object(h.c)({name:"configuration",initialState:K,reducers:{updateConfiguration:function(e,t){return Object(u.a)({},e,{},t.payload)}}}),L=G.actions.updateConfiguration,N=G.reducer,W=Object(g.c)({solarSystems:C,killmails:B,connection:J,configuration:N}),H=Object(h.a)({reducer:W,middleware:Object(h.d)({serializableCheck:!1,immutableCheck:!1})}),Q=function(){return Object(b.b)()},X=b.c,Y=H,Z=n(62),$=n.n(Z),ee=n(134),te=n.n(ee),ne=n(136),re=n(137),ae=function(e){return JSON.stringify({action:"sub",channel:e})},oe=function(e){try{var t=e.killmail_id,n=e.killmail_time,r=e.victim,a=e.solar_system_id,o=e.zkb;return{id:t,time:Object(s.a)(n),receivedAt:new Date,characterId:r.character_id,corporationId:r.corporation_id,allianceId:r.alliance_id,shipTypeId:r.ship_type_id,solarSystemId:a,url:o.url,totalValue:o.totalValue,scaledValue:v(o.totalValue)}}catch(c){return null}};function ce(e){var t=e.sourceUrl,n=e.preloadRecent,r=Q();Object(a.useEffect)((function(){var e=setInterval((function(){r(R(45e3))}),5e3);return function(){return clearInterval(e)}}),[r]),Object(a.useEffect)((function(){n&&fetch("https://tmikoss.github.io/zkb-map/api/recent").then((function(e){return e.json()})).then((function(e){var t=function(e){if(e.length<1)return e;var t=Object(ne.a)($()(e,"time")),n=Object(M.a)(new Date,t);return $()(e,(function(e){return Object(u.a)({},e,{receivedAt:Object(re.a)(e.time,n)})}))}(te()($()(e,oe)));$()(t,(function(e){r(F({killmail:e,normalAge:45e3}))}))}))}),[r,n]),Object(a.useEffect)((function(){var e=new WebSocket(t);return e.onopen=function(){e.send(ae("killstream")),e.send(ae("public"))},e.onmessage=function(e){var t=JSON.parse(e.data);if("killmail_id"in t){var n=oe(t);n&&r(F({killmail:n,normalAge:45e3}))}else"tqStatus"in t?r(U()):console.error(t)},e.onclose=function(e){console.error(e)},function(){return e.close()}}),[t,r])}var ie=n(19),le=n(138),ue={background:"#060606",colorMaxSec:"#2A9FD6",colorMinSec:"#E6E6E6",flare:"#E60000",text:"#E6E6E6",unit:32,gapSize:8},se=function(e){return{positions:new Float32Array(3*e),colors:new Float32Array(3*e),scales:new Float32Array(e)}},fe=function(e,t,n,r){e.setAttribute("position",new f.BufferAttribute(t,3)),e.setAttribute("flareColor",new f.BufferAttribute(n,3)),e.setAttribute("size",new f.BufferAttribute(r,1)),e.attributes.position.needsUpdate=!0,e.attributes.flareColor.needsUpdate=!0,e.attributes.size.needsUpdate=!0},me=new f.Vector3,de=function(e,t,n){var r=e.x,a=e.y,o=e.z;me.x=r,me.y=a,me.z=o,me.toArray(t,3*n)},ve=n(142),pe=n.n(ve),he=(new f.TextureLoader).load(pe.a),be={color:{value:new f.Color},pointTexture:{value:he}},ge=Object(a.forwardRef)((function(e,t){return o.a.createElement("points",{ref:t},o.a.createElement("bufferGeometry",{attach:"geometry"}),o.a.createElement("shaderMaterial",{uniforms:be,vertexShader:"\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n",blending:f.AdditiveBlending,depthTest:!1,transparent:!0,attach:"material"}))})),je=o.a.memo((function(e){var t=e.solarSystems,n=Object(a.useRef)(),r=Object(a.useContext)(ie.a),c=p();return Object(m.e)((function(){if(n.current){for(var e=new f.Color(r.colorMaxSec),a=Object.values(t),o=a.length,i=c/75,l=se(o),u=l.positions,s=l.colors,m=l.scales,d=0;d<o;d++){var v=a[d];de(v,u,d),new f.Color(r.colorMinSec).lerp(e,v.security).toArray(s,3*d),m[d]=i*v.radius}fe(n.current.geometry,u,s,m)}})),o.a.createElement(ge,{ref:n})})),Oe=o.a.memo((function(e){var t=e.solarSystems,n=e.killmails,r=Object(a.useRef)(),c=Object(a.useContext)(ie.a),i=p();return Object(m.e)((function(){if(n.current&&r.current){for(var e=n.current.length,a=new Date,o=i/8,l=new f.Color(c.flare),u=se(e),s=u.positions,m=u.colors,v=u.scales,p=0;p<n.current.length;p++){var h=n.current[p],b=h.receivedAt,g=h.solarSystemId,j=h.scaledValue,O=t[g]||{},y=Object(M.a)(a,b);v[p]=o*j*d(y,j),de(O,s,p),l.toArray(m,3*p)}fe(r.current.geometry,s,m,v)}})),o.a.createElement(ge,{ref:r})})),ye=n(10),Ee=n(84);function we(){var e=Object(l.a)(["\n  grid-area: ",";\n  text-decoration: none;\n"]);return we=function(){return e},e}function ke(){var e=Object(l.a)(['\n  display: grid;\n  grid-template-areas: "ship character corporation alliance";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  padding-bottom: ","px;\n"]);return ke=function(){return e},e}function xe(){var e=Object(l.a)(["\n  overflow: hidden;\n  max-height: calc(100vh - ","px);\n  display: flex;\n  flex-flow: column;\n"]);return xe=function(){return e},e}var Se=ie.e.div(xe(),(function(e){return e.theme.unit})),Ce=Object(ie.e)(Ee.a.div)(ke(),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize}),(function(e){return e.theme.gapSize})),ze=ie.e.a(we(),(function(e){return e.area})),Ae=function(e){var t=e.src,n=e.area,r=e.href,a=e.height,c=e.size;return o.a.createElement(ze,{href:r,area:n,target:"_blank"},o.a.createElement(Ee.a.img,{src:"".concat(t,"?size=").concat(c),style:{height:a,width:c},alt:""}))},Me=o.a.memo((function(e){var t,n=e.killmail,r=Object(a.useContext)(ie.a),c=n.characterId,i=n.corporationId,l=n.allianceId,u=n.shipTypeId,s=n.url,f=n.receivedAt,m=n.scaledValue,v=Object(Ee.b)((function(){return{opacity:0,height:0,paddingBottom:0}})),p=Object(ye.a)(v,2),h=p[0],b=h.opacity,g=h.height,j=h.paddingBottom,O=p[1],y=Object(a.useCallback)((function(){var e,t=Object(M.a)(new Date,f),n=d(t,m);t<500||n>.1?e=r.unit:(e=0,n=0),O({opacity:n,height:e,paddingBottom:e/8})}),[O,f,m,r.unit]);return t=y,Object(a.useEffect)((function(){var e;return e=requestAnimationFrame((function n(){t(),e=requestAnimationFrame(n)})),function(){return cancelAnimationFrame(e)}}),[t]),o.a.createElement(Ce,{style:{opacity:b,paddingBottom:j,gridAutoRows:g}},u&&o.a.createElement(Ae,{src:"https://images.evetech.net/types/".concat(u,"/render"),area:"ship",height:g,href:s,size:r.unit}),c&&o.a.createElement(Ae,{src:"https://images.evetech.net/characters/".concat(c,"/portrait"),area:"character",height:g,href:"https://zkillboard.com/character/".concat(c,"/"),size:r.unit}),i&&o.a.createElement(Ae,{src:"https://images.evetech.net/corporations/".concat(i,"/logo"),area:"corporation",height:g,href:"https://zkillboard.com/corporation/".concat(i,"/"),size:r.unit}),l&&o.a.createElement(Ae,{src:"https://images.evetech.net/alliances/".concat(l,"/logo"),area:"alliance",height:g,href:"https://zkillboard.com/alliance/".concat(l,"/"),size:r.unit}))})),Ie=function(e){var t=e.killmails.map((function(e){return o.a.createElement(Me,{killmail:e,key:e.id})}));return o.a.createElement(Se,null,t)},_e=n(81);n(40),n(143);function De(){var e=Object(l.a)(["\n  color: ",";\n  display: flex;\n  flex-flow: column;\n  gap: 1vh;\n"]);return De=function(){return e},e}ie.e.div(De(),(function(e){return e.theme.text})),(new Date).getTime();var Fe,Re,Be,Ve=n(11),Pe=n(85);function Te(){var e=Object(l.a)(["\n  color: ",";\n  background: transparent;\n  border: none;\n  grid-area: ",";\n  cursor: ",";\n"]);return Te=function(){return e},e}function Ue(){var e=Object(l.a)(["\n  color: ",';\n  display: grid;\n  grid-template-areas: "fullscreen connection camera";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  direction: rtl;\n"]);return Ue=function(){return e},e}var qe=ie.e.div(Ue(),(function(e){return e.theme.text}),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize})),Je=ie.e.button(Te(),(function(e){return e.theme.text}),(function(e){return e.area}),(function(e){return e.onClick?"pointer":"default"})),Ke=function(){var e=Object(a.useState)(!1),t=Object(ye.a)(e,2),n=t[0],r=t[1];return o.a.createElement(Je,{type:"button",title:n?"Exit fullscreen":"Go fullscreen",onClick:function(){var e;n?document.exitFullscreen().then((function(){return r(!1)})):null===(e=document.getElementById("root"))||void 0===e||e.requestFullscreen().then((function(){return r(!0)}))},area:"fullscreen"},o.a.createElement(Pe.a,{icon:n?"compress-arrows-alt":"expand-arrows-alt"}))},Ge=function(){var e=X((function(e){return e.connection.connected}));return o.a.createElement(Je,{type:"button",title:e?"Connected to live feed":"Disconnected from live feed!",area:"connection"},o.a.createElement(Pe.a,{icon:e?"link":"unlink"}))},Le=(Fe={},Object(Ve.a)(Fe,r.full,"globe"),Object(Ve.a)(Fe,r.follow,"video"),Fe),Ne=(Re={},Object(Ve.a)(Re,r.full,r.follow),Object(Ve.a)(Re,r.follow,r.full),Re),We=(Be={},Object(Ve.a)(Be,r.full,"Camera: whole map"),Object(Ve.a)(Be,r.follow,"Camera: follow the action"),Be),He=function(){var e=X((function(e){return e.configuration.cameraMode})),t=Q();return o.a.createElement(Je,{type:"button",title:We[e],onClick:function(){t(L({cameraMode:Ne[e]}))},area:"camera"},o.a.createElement(Pe.a,{icon:Le[e]}))},Qe=function(){return o.a.createElement(qe,null,o.a.createElement(Ke,null),o.a.createElement(Ge,null),o.a.createElement(He,null))},Xe=new f.Vector3(0,0,700),Ye=Xe.z/3,Ze=o.a.memo((function(e){var t=e.solarSystems,n=e.mode,c=e.killmails,i=Object(a.useRef)(),l=Object(a.useRef)(Xe);return Object(a.useEffect)((function(){var e=Object.values(t);e.length>0&&(l.current=function(e){for(var t=e.length,n=new Float32Array(3*t),r=0;r<t;r++)de(e[r],n,r);var a=new f.BufferGeometry;if(a.setAttribute("position",new f.BufferAttribute(n,3)),a.computeBoundingSphere(),a.boundingSphere){var o=a.boundingSphere,c=o.center,i=o.radius;return c.z+=Math.max(1.1*i,Ye),c}return Xe}(e),i.current&&i.current.position.lerp(l.current,1))}),[t]),Object(m.e)((function(){if(i.current&&l.current){var e,a=l.current,o=(null===(e=c.current)||void 0===e?void 0:e.length)||0;if(o>0&&n===r.follow){for(var u=new Date,s=-1/0,m=-1/0,v=-1/0,p=1/0,h=1/0,b=1/0,g=0,j=0,O=0,y=0,E=0;E<o;E++){var w=c.current[E],k=w.solarSystemId,x=w.scaledValue,S=w.receivedAt,C=t[k],z=C.x,A=C.y,I=C.z,_=Object(M.a)(u,S),D=x*d(_,x);if(D>.1){var F=D*z,R=D*A,B=D*I;s=Math.max(s,z),m=Math.max(m,A),v=Math.max(v,I),p=Math.min(p,z),h=Math.min(h,A),b=Math.min(b,I),g+=F,j+=R,O+=B,y+=D}}if(y>0){var V=g/y,P=j/y,T=O/y,U=Math.max(s-V,m-P,v-T,V-p,P-h,T-b,Ye);a=new f.Vector3(V,P,T+1.1*U)}}i.current.position.lerp(a,.01)}})),o.a.createElement(o.a.Fragment,null,o.a.createElement(_e.a,{ref:i,makeDefault:!0,near:.001,far:1e4,fov:90}))})),$e=n(149),et=n.n($e),tt=n(150),nt=n.n(tt),rt=n(64),at=function(){return o.a.createElement(rt.b,{multisampling:0},o.a.createElement(rt.a,{luminanceThreshold:.2,luminanceSmoothing:.9,intensity:3}),o.a.createElement(rt.c,{opacity:.04}),o.a.createElement(rt.d,{eskil:!1,offset:.1,darkness:1.1}))};function ot(){var e=Object(l.a)(["\n  position: absolute;\n  top: 1vmin;\n  right: 1vmin;\n"]);return ot=function(){return e},e}function ct(){var e=Object(l.a)(["\n  position: absolute;\n  top: 1vmin;\n  left: 1vmin;\n"]);return ct=function(){return e},e}function it(){var e=Object(l.a)(["\n  ","\n\n  #root {\n    height: 100vh;\n    background: ",";\n    overflow: hidden;\n  }\n\n  canvas {\n    outline: 0;\n  }\n"]);return it=function(){return e},e}var lt=Object(ie.c)(it(),le.a,(function(e){return e.theme.background})),ut=ie.e.div(ct()),st=ie.e.div(ot()),ft=function(){var e=Q();ce({sourceUrl:"wss://zkillboard.com/websocket/",preloadRecent:!1}),function(){var e=Q();Object(a.useEffect)((function(){var t=setInterval((function(){e(q())}),5e3);return function(){return clearInterval(t)}}),[e])}(),Object(a.useEffect)((function(){e(S())}),[e]);var t=Object(a.useRef)([]),n=X((function(e){return e.solarSystems})),r=X((function(e){var t=nt()(e.killmails,(function(e,t){return n[t.solarSystemId]&&e.push(t),e}),[]);return et()(t,"receivedAt").reverse()})),c=X((function(e){return e.configuration.cameraMode}));return Object(a.useEffect)((function(){t.current=r}),[r]),o.a.createElement(ie.b,{theme:ue},o.a.createElement(lt,null),o.a.createElement(m.a,{onCreated:function(e){return e.gl.setClearColor(ue.background)}},o.a.createElement(ie.a.Provider,{value:ue},o.a.createElement("ambientLight",null),o.a.createElement(je,{solarSystems:n}),o.a.createElement(Oe,{solarSystems:n,killmails:t}),o.a.createElement(Ze,{solarSystems:n,killmails:t,mode:c}),o.a.createElement(at,null))),o.a.createElement(ut,null,o.a.createElement(Ie,{killmails:r})),o.a.createElement(st,null,o.a.createElement(Qe,null),!1))},mt=n(60),dt=n(45);mt.b.add(dt.a,dt.b,dt.d,dt.e,dt.f,dt.c);var vt;vt=ft,i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(b.a,{store:Y},o.a.createElement(vt,null))),document.getElementById("root"))}},[[153,1,2]]]);
//# sourceMappingURL=main.bd4a81f0.chunk.js.map
(this["webpackJsonpzkb-map"]=this["webpackJsonpzkb-map"]||[]).push([[0],{127:function(e,t,n){e.exports=n.p+"static/media/glow.3b6b0c75.png"},142:function(e,t,n){e.exports=n(260)},260:function(e,t,n){"use strict";n.r(t);var r,a=n(1),c=n.n(a),o=n(40),i=n.n(o),u=n(23),l=n(16),s=n(123),f=n(8),m={background:"#060606",colorMaxSec:"#2A9FD6",colorMinSec:"#E6E6E6",flare:"#E60000",text:"#E6E6E6",unit:32,gapSize:8,regionFontSize:8},d=n(0),b=function(e){return{positions:new Float32Array(3*e),colors:new Float32Array(3*e),scales:new Float32Array(e)}},v=function(e,t,n,r){e.setAttribute("position",new d.BufferAttribute(t,3)),e.setAttribute("flareColor",new d.BufferAttribute(n,3)),e.setAttribute("size",new d.BufferAttribute(r,1)),e.attributes.position.needsUpdate=!0,e.attributes.flareColor.needsUpdate=!0,e.attributes.size.needsUpdate=!0},h=new d.Vector3,p=function(e,t,n){var r=e.x,a=e.y,c=e.z;h.x=r,h.y=a,h.z=c,h.toArray(t,3*n)},g=n(127),j=n.n(g),O=(new d.TextureLoader).load(j.a),y={color:{value:new d.Color},pointTexture:{value:O}},E=Object(a.forwardRef)((function(e,t){return c.a.createElement("points",Object.assign({ref:t},e),c.a.createElement("bufferGeometry",{attach:"geometry"}),c.a.createElement("shaderMaterial",{uniforms:y,vertexShader:"\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n",blending:d.AdditiveBlending,depthTest:!1,transparent:!0,attach:"material"}))})),k=n(10),w=n(41),x=n(29),C=n(73),z=n.n(C),S=n(28),M=n(139),A=Object(S.a)((function(e){return{connected:!1,pingReceived:void 0,receivePing:function(){return e({connected:!0,pingReceived:new Date})},checkConnection:function(){return e((function(e){var t=e.pingReceived;return{connected:!!t&&Object(x.a)(new Date,t)<15e3}}))}}})),I=function(e,t){var n=t.scaledValue,r=t.receivedAt;return Object(x.a)(e,r)<45e3*n},R=function(e){return JSON.stringify({action:"sub",channel:e})},_=Object(S.a)((function(e){return{killmails:{},focused:void 0,receiveKillmail:function(t){e((function(e){return{killmails:Object(w.a)({},e.killmails,Object(k.a)({},t.id,t))}}))},trimKillmails:function(){var t=I.bind(void 0,new Date);e((function(e){var n=z()(e.killmails,t),r={killmails:n};return e.focused&&!n[e.focused.id]&&(r.focused=void 0),r}))},focus:function(t){e((function(e){return{focused:e.killmails[t]}}))},unfocus:function(t){e((function(e){return e.focused&&e.focused.id===t?{focused:void 0}:{}}))}}})),F=function(e){var t=A(Object(a.useCallback)((function(e){return e.receivePing}),[])),n=_(Object(a.useCallback)((function(e){return e.trimKillmails}),[])),r=_(Object(a.useCallback)((function(e){return e.receiveKillmail}),[]));Object(a.useEffect)((function(){var e=setInterval(n,5e3);return function(){return clearInterval(e)}}),[n]),Object(a.useEffect)((function(){var n=new WebSocket(e);return n.onopen=function(){n.send(R("killstream")),n.send(R("public"))},n.onmessage=function(e){var n=JSON.parse(e.data);"killmail_id"in n?r(function(e){var t=e.killmail_id,n=e.killmail_time,r=e.victim,a=e.solar_system_id,c=e.zkb,o=r.character_id,i=r.corporation_id,u=r.alliance_id,l=r.ship_type_id,s=c.url,f=c.totalValue;return{id:t,time:Object(M.a)(n),receivedAt:new Date,characterId:o,corporationId:i,allianceId:u,shipTypeId:l,solarSystemId:a,url:s,totalValue:f,scaledValue:V(f)}}(n)):"tqStatus"in n?t():console.error(n)},n.onclose=function(e){console.error(e)},function(){return n.close()}}),[e,r,t])},B=function(e,t){return t*function(e,t){if(e<500)return d.MathUtils.smoothstep(e,0,500);var n=45e3*t,r=d.MathUtils.smoothstep(e,500,n)-1;return Math.pow(r,4)}(e,t)},V=function(e){var t=d.MathUtils.clamp(e,1e4,1e10);return d.MathUtils.mapLinear(t,1e4,1e10,1,10)},D=function(){var e=Object(f.g)().size,t=e.height,n=e.width;return Math.min(t,n)},T=function(e){var t=e.solarSystems,n=Object(a.useRef)(null),r=Object(a.useContext)(l.a),o=D();return Object(f.e)((function(){if(n.current){for(var e=new d.Color(r.colorMaxSec),a=Object.values(t),c=a.length,i=o/75,u=b(c),l=u.positions,s=u.colors,f=u.scales,m=0;m<c;m++){var h=a[m];p(h,l,m),new d.Color(r.colorMinSec).lerp(e,h.security).toArray(s,3*m),f[m]=i*h.radius}v(n.current.geometry,l,s,f)}})),c.a.createElement(E,{ref:n})},U=function(e){var t=e.solarSystems,n=e.killmails,r=Object(a.useRef)(null),o=Object(a.useContext)(l.a),i=D();return Object(f.e)((function(){if(n.current&&r.current){for(var e=n.current.length,a=new Date,c=i/8,u=new d.Color(o.flare),l=b(e),s=l.positions,f=l.colors,m=l.scales,h=0;h<n.current.length;h++){var g=n.current[h],j=g.receivedAt,O=g.solarSystemId,y=g.scaledValue,E=t[O]||{},k=Object(x.a)(a,j);m[h]=c*B(k,y),p(E,s,h),u.toArray(f,3*h)}v(r.current.geometry,s,f,m)}})),c.a.createElement(E,{ref:r})},N=n(9),P=n(80);!function(e){e[e.full=0]="full",e[e.follow=1]="follow"}(r||(r={}));var G=Object(S.a)((function(e){return{cameraMode:r.full,showRegionNames:!1,setCameraMode:function(t){return e({cameraMode:t})},toggleRegionNames:function(){return e((function(e){return{showRegionNames:!e.showRegionNames}}))}}})),J=n(55),K=n.n(J),L=Object(S.a)((function(e){return{systems:{},regions:{},loaded:!1,receive:function(t){var n=K()(t.regions,(function(e,t,n){var r=t.x,a=t.y,c=t.z,o=t.n;return e[n]={id:parseInt(n),x:r,y:c,z:a,name:o},e}),{}),r=K()(t.systems,(function(e,t,n){var r=t.x,a=t.y,c=t.z,o=t.n,i=t.r,u=t.s,l=t.p;return e[n]={id:parseInt(n),x:r,y:c,z:a,name:o,radius:d.MathUtils.clamp(100*i,.5,1.5),security:u,regionId:l},e}),{});e({regions:n,systems:r,loaded:!0})}}})),q=function(e){return e.loaded},X=function(e){return e.receive};function Y(){var e=Object(u.a)(["\n  grid-area: ",";\n  text-decoration: none;\n"]);return Y=function(){return e},e}function W(){var e=Object(u.a)(['\n  display: grid;\n  grid-template-areas: "ship character corporation alliance";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  padding-bottom: ","px;\n"]);return W=function(){return e},e}function H(){var e=Object(u.a)(["\n  overflow: hidden;\n  max-height: calc(100vh - ","px);\n  display: flex;\n  flex-flow: column;\n"]);return H=function(){return e},e}var Q=l.e.div(H(),(function(e){return e.theme.unit})),Z=Object(l.e)(P.a.div)(W(),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize}),(function(e){return e.theme.gapSize})),$=l.e.a(Y(),(function(e){return e.area})),ee=function(e){var t=e.src,n=e.area,r=e.href,a=e.height,o=e.size;return c.a.createElement($,{href:r,area:n,target:"_blank"},c.a.createElement(P.a.img,{src:"".concat(t,"?size=").concat(o),style:{height:a,width:o},alt:""}))},te=Object(a.memo)((function(e){var t=e.killmail,n=Object(a.useContext)(l.a).unit,r=t.id,o=t.characterId,i=t.corporationId,u=t.allianceId,s=t.shipTypeId,f=t.url,m=t.receivedAt,b=t.scaledValue,v=Object(P.b)((function(){return{opacity:0,height:0,paddingBottom:0}})),h=Object(N.a)(v,2),p=h[0],g=p.height,j=p.paddingBottom,O=p.opacity,y=h[1],E=Object(a.useRef)(!1),k=Object(a.useRef)(!0);Object(a.useEffect)((function(){return _.subscribe((function(e){E.current=!!e.focused&&e.focused.id===r}))})),Object(a.useEffect)((function(){var e=function(){var e,t=Object(x.a)(new Date,m),r=n,a=n/8,c=1e3;if(t<500)e=1,c=250;else{var o=B(t,b);o>.1?e=E.current?1:d.MathUtils.clamp(o,0,1):(e=0,r=0,a=0,c=250)}k.current=e>0,y({opacity:e,height:r,paddingBottom:a,config:{duration:c}})},t=setInterval(e,1e3);return e(),function(){return clearInterval(t)}}),[y,m,b,n]);var w=_(Object(a.useCallback)((function(e){return e.focus}),[])),C=_(Object(a.useCallback)((function(e){return e.unfocus}),[])),z=Object(a.useCallback)((function(){y({opacity:1,config:{duration:50}}),k.current&&w(r)}),[w,r,y]),S=Object(a.useCallback)((function(){return C(r)}),[C,r]);return c.a.createElement(Z,{style:{opacity:O,paddingBottom:j,gridAutoRows:g},onMouseEnter:z,onMouseLeave:S},s&&c.a.createElement(ee,{src:"https://images.evetech.net/types/".concat(s,"/render"),area:"ship",height:g,href:f,size:n}),o&&c.a.createElement(ee,{src:"https://images.evetech.net/characters/".concat(o,"/portrait"),area:"character",height:g,href:"https://zkillboard.com/character/".concat(o,"/"),size:n}),i&&c.a.createElement(ee,{src:"https://images.evetech.net/corporations/".concat(i,"/logo"),area:"corporation",height:g,href:"https://zkillboard.com/corporation/".concat(i,"/"),size:n}),u&&c.a.createElement(ee,{src:"https://images.evetech.net/alliances/".concat(u,"/logo"),area:"alliance",height:g,href:"https://zkillboard.com/alliance/".concat(u,"/"),size:n}))})),ne=function(e){var t=e.killmails.map((function(e){return c.a.createElement(te,{killmail:e,key:e.id})}));return c.a.createElement(Q,null,t)},re=n(35);n(37),n(132);function ae(){var e=Object(u.a)(["\n  color: ",";\n  display: flex;\n  flex-flow: column;\n  gap: 1vh;\n"]);return ae=function(){return e},e}l.e.div(ae(),(function(e){return e.theme.text})),(new Date).getTime();var ce,oe,ie,ue=n(58);function le(){var e=Object(u.a)(["\n  color: ",";\n  background: transparent;\n  border: none;\n  grid-area: ",";\n  cursor: ",";\n  outline: none;\n"]);return le=function(){return e},e}function se(){var e=Object(u.a)(["\n  color: ",';\n  display: grid;\n  grid-template-areas: "fullscreen connection camera regions";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  direction: rtl;\n"]);return se=function(){return e},e}var fe=l.e.div(se(),(function(e){return e.theme.text}),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize})),me=l.e.button(le(),(function(e){return e.theme.text}),(function(e){return e.area}),(function(e){return e.onClick?"pointer":"default"})),de=function(){var e=Object(a.useState)(!1),t=Object(N.a)(e,2),n=t[0],r=t[1];return c.a.createElement(me,{type:"button",title:n?"Exit fullscreen":"Go fullscreen",onClick:function(){var e;n?document.exitFullscreen().then((function(){return r(!1)})):null===(e=document.getElementById("root"))||void 0===e||e.requestFullscreen().then((function(){return r(!0)}))},area:"fullscreen"},c.a.createElement(ue.a,{icon:n?"compress-arrows-alt":"expand-arrows-alt"}))},be=function(){var e=A(Object(a.useCallback)((function(e){return e.connected}),[]));return c.a.createElement(me,{type:"button",title:e?"Connected to live feed":"Disconnected from live feed!",area:"connection"},c.a.createElement(ue.a,{icon:e?"link":"unlink"}))},ve=(ce={},Object(k.a)(ce,r.full,"globe"),Object(k.a)(ce,r.follow,"video"),ce),he=(oe={},Object(k.a)(oe,r.full,r.follow),Object(k.a)(oe,r.follow,r.full),oe),pe=(ie={},Object(k.a)(ie,r.full,"Camera: whole map"),Object(k.a)(ie,r.follow,"Camera: follow the action"),ie),ge=function(){var e=G(Object(a.useCallback)((function(e){return e.cameraMode}),[])),t=G(Object(a.useCallback)((function(e){return e.setCameraMode}),[]));return c.a.createElement(me,{type:"button",title:pe[e],onClick:function(){t(he[e])},area:"camera"},c.a.createElement(ue.a,{icon:ve[e]}))},je=function(){var e=G(Object(a.useCallback)((function(e){return e.showRegionNames}),[])),t=G(Object(a.useCallback)((function(e){return e.toggleRegionNames}),[]));return c.a.createElement(me,{type:"button",title:e?"Region names shown":"Region names hidden",onClick:t,area:"regions"},c.a.createElement(ue.a,{icon:e?"list-alt":"list"}))},Oe=function(){return c.a.createElement(fe,null,c.a.createElement(de,null),c.a.createElement(be,null),c.a.createElement(ge,null),c.a.createElement(je,null))},ye=new d.Vector3(0,0,700),Ee=ye.z/3,ke=c.a.memo((function(e){var t=e.solarSystems,n=e.killmails,o=G(Object(a.useCallback)((function(e){return e.cameraMode}),[])),i=Object(a.useRef)(),u=Object(a.useRef)(ye);return Object(a.useEffect)((function(){var e=Object.values(t);e.length>0&&(u.current=function(e){for(var t=e.length,n=new Float32Array(3*t),r=0;r<t;r++)p(e[r],n,r);var a=new d.BufferGeometry;if(a.setAttribute("position",new d.BufferAttribute(n,3)),a.computeBoundingSphere(),a.boundingSphere){var c=a.boundingSphere,o=c.center,i=c.radius;return o.z+=Math.max(1.1*i,Ee),o}return ye}(e),i.current&&i.current.position.lerp(u.current,1))}),[t]),Object(f.e)((function(){if(i.current&&u.current){var e,a,c=(null===(e=n.current)||void 0===e?void 0:e.length)||0;if(c>0&&o===r.follow){for(var l=new Date,s=-1/0,f=-1/0,m=-1/0,b=1/0,v=1/0,h=1/0,p=0,g=0,j=0,O=0,y=0;y<c;y++){var E=n.current[y],k=E.solarSystemId,w=E.scaledValue,C=E.receivedAt,z=t[k],S=z.x,M=z.y,A=z.z,I=Object(x.a)(l,C),R=B(I,w);if(R>.1){var _=R*S,F=R*M,V=R*A;s=Math.max(s,S),f=Math.max(f,M),m=Math.max(m,A),b=Math.min(b,S),v=Math.min(v,M),h=Math.min(h,A),p+=_,g+=F,j+=V,O+=R}}if(O>0){var D=p/O,T=g/O,U=j/O,N=Math.max(s-D,f-T,m-U,D-b,T-v,U-h,Ee);a=new d.Vector3(D,T,U+1.1*N)}else a=u.current.clone()}else a=u.current.clone();i.current.aspect<1&&a.multiply(new d.Vector3(1,1,1/i.current.aspect)),i.current.position.lerp(a,.01)}})),c.a.createElement(c.a.Fragment,null,c.a.createElement(re.a,{ref:i,makeDefault:!0,near:.001,far:1e5,fov:90}))})),we=n(138),xe=n.n(we),Ce=n(59),ze=Object(a.memo)((function(){var e=Object(f.g)().gl.capabilities.maxTextureSize>8192?8:0;return c.a.createElement(Ce.b,{multisampling:e},c.a.createElement(Ce.a,{luminanceThreshold:.2,luminanceSmoothing:.9,intensity:3}),c.a.createElement(Ce.c,{opacity:.04}),c.a.createElement(Ce.d,{eskil:!1,offset:.1,darkness:1.1}))})),Se=Object(a.memo)((function(e){var t=e.solarSystems,n=Object(a.useContext)(l.a),r=G(Object(a.useCallback)((function(e){return e.showRegionNames}),[])),o=L(Object(a.useCallback)((function(e){for(var n=new Set,r=0,a=Object.values(t);r<a.length;r++){var c=a[r];n.add(c.regionId)}return Object.values(z()(e.regions,(function(e){return n.has(e.id)})))}),[t]));if(!r)return null;var i=o.map((function(e){var t=e.id,r=e.x,a=e.y,o=e.z,i=e.name,u=new d.Vector3(r,a,o);return c.a.createElement(re.c,{anchorX:"center",anchorY:"middle",position:u,color:n.text,fontSize:n.regionFontSize,key:t},i)}));return c.a.createElement(c.a.Fragment,null,i)})),Me=n(81),Ae=n.n(Me),Ie=Object(a.memo)((function(){var e=L(Object(a.useCallback)((function(e){return e.systems}),[])),t=L(Object(a.useCallback)((function(e){return e.regions}),[])),n=Object(a.useRef)(),r=Object(a.useRef)(),o=Object(a.useRef)(),i=Object(a.useContext)(l.a),u=Object(a.useRef)(null),s=Object(a.useRef)(null),m=Object(f.g)().camera;return Object(a.useEffect)((function(){return _.subscribe((function(a){n.current=a.focused,r.current=a.focused?e[a.focused.solarSystemId]:void 0,o.current=r.current?t[r.current.regionId]:void 0}))})),Object(f.e)((function(){var e,t=new Float32Array(0),a="",c=0,i=0,l=0,f="left",b="top",v=0;if(n.current&&r.current){var h=n.current.totalValue,p=r.current,g=p.x,j=p.y,O=p.z,y=p.name,E=m.position,k=E.x,w=E.y,x=E.z-O,C=x/40,z=g>k?-C:C,S=j>w?-C:C,M=C/10,A=g+z,I=j+S,R=O+M,_=A+5*z,F=_+5*z,B=I+3*S,V=R+3*M,D=y;o.current&&(D="".concat(y,", ").concat(o.current.name)),a="".concat((e=h,e>5e8?"".concat(Ae()(e/1e9,1),"b"):e>5e5?"".concat(Ae()(e/1e6,1),"m"):"".concat(Ae()(e/1e3,1),"k"))," ").concat(D),c=_,i=B,l=V,f=z>0?"left":"right",b=S>0?"bottom":"top",v=x/30,t=new Float32Array([A,I,R,_,B,V,F,B,V])}if(u.current){var T=u.current.geometry;T.setAttribute("position",new d.BufferAttribute(t,3)),T.attributes.position.needsUpdate=!0}if(s.current){var U=s.current;U.text=a,U.position.set(c,i,l),U.anchorX=f,U.anchorY=b,U.fontSize=v}})),c.a.createElement("group",null,c.a.createElement("line",{ref:u},c.a.createElement("bufferGeometry",{attach:"geometry"}),c.a.createElement("meshBasicMaterial",{attach:"material",color:i.text})),c.a.createElement(re.c,{ref:s,color:i.text,fontSize:0,children:""}))}));function Re(){var e=Object(u.a)(["\n  position: absolute;\n  top: 1vmin;\n  right: 1vmin;\n"]);return Re=function(){return e},e}function _e(){var e=Object(u.a)(["\n  position: absolute;\n  top: 1vmin;\n  left: 1vmin;\n"]);return _e=function(){return e},e}function Fe(){var e=Object(u.a)(["\n  ","\n\n  #root {\n    height: 100vh;\n    background: ",";\n    overflow: hidden;\n  }\n\n  canvas {\n    outline: 0;\n  }\n"]);return Fe=function(){return e},e}var Be=Object(l.c)(Fe(),s.a,(function(e){return e.theme.background})),Ve=l.e.div(_e()),De=l.e.div(Re()),Te=Object(a.memo)((function(e){var t=e.solarSystems,n=e.killmails;return c.a.createElement(f.a,{onCreated:function(e){return e.gl.setClearColor(m.background)}},c.a.createElement(l.a.Provider,{value:m},c.a.createElement("ambientLight",null),c.a.createElement(T,{solarSystems:t}),c.a.createElement(U,{solarSystems:t,killmails:n}),c.a.createElement(Se,{solarSystems:t}),c.a.createElement(Ie,null),c.a.createElement(ke,{solarSystems:t,killmails:n}),c.a.createElement(ze,null)))})),Ue=function(){F("wss://zkillboard.com/websocket/"),function(e){var t=L(q),n=L(X);Object(a.useEffect)((function(){if(!t){var r=new AbortController;return fetch(e,{signal:r.signal}).then((function(e){return e.json()})).then(n),function(){return r.abort()}}}),[e,t,n])}("https://tmikoss.github.io/zkb-map/data/universe.json"),function(){var e=A(Object(a.useCallback)((function(e){return e.checkConnection}),[]));Object(a.useEffect)((function(){var t=setInterval(e,5e3);return function(){return clearInterval(t)}}),[e])}();var e=Object(a.useRef)([]),t=L(Object(a.useCallback)((function(e){return e.systems}),[])),n=_(Object(a.useCallback)((function(e){var n=K()(e.killmails,(function(e,n){return t[n.solarSystemId]&&e.push(n),e}),[]);return xe()(n,"receivedAt").reverse()}),[t]));return Object(a.useEffect)((function(){e.current=n}),[n]),c.a.createElement(l.b,{theme:m},c.a.createElement(Be,null),c.a.createElement(Te,{solarSystems:t,killmails:e}),c.a.createElement(Ve,null,c.a.createElement(ne,{killmails:n})),c.a.createElement(De,null,c.a.createElement(Oe,null),!1))},Ne=n(56),Pe=n(32);Ne.b.add(Pe.a,Pe.b,Pe.d,Pe.g,Pe.h,Pe.c,Pe.e,Pe.f);var Ge;Ge=Ue,i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(Ge,null)),document.getElementById("root"))}},[[142,1,2]]]);
//# sourceMappingURL=main.24c9ad67.chunk.js.map
(this["webpackJsonpzkb-map"]=this["webpackJsonpzkb-map"]||[]).push([[0],{124:function(e,t,n){e.exports=n.p+"static/media/glow.3b6b0c75.png"},140:function(e,t,n){e.exports=n(259)},259:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(39),i=n.n(o),c=n(23),l=n(17),u=n(120),s=n(10),f={background:"#060606",colorMaxSec:"#2A9FD6",colorMinSec:"#E6E6E6",flare:"#E60000",text:"#E6E6E6",unit:32,gapSize:8,regionFontSize:8},m=n(0),d=function(e){return{positions:new Float32Array(3*e),colors:new Float32Array(3*e),scales:new Float32Array(e)}},v=function(e,t,n,r){e.setAttribute("position",new m.BufferAttribute(t,3)),e.setAttribute("flareColor",new m.BufferAttribute(n,3)),e.setAttribute("size",new m.BufferAttribute(r,1)),e.attributes.position.needsUpdate=!0,e.attributes.flareColor.needsUpdate=!0,e.attributes.size.needsUpdate=!0},b=new m.Vector3,h=function(e,t,n){var r=e.x,a=e.y,o=e.z;b.x=r,b.y=a,b.z=o,b.toArray(t,3*n)},p=n(124),g=n.n(p),j=(new m.TextureLoader).load(g.a),O={color:{value:new m.Color},pointTexture:{value:j}},y=Object(r.forwardRef)((function(e,t){return a.a.createElement("points",{ref:t},a.a.createElement("bufferGeometry",{attach:"geometry"}),a.a.createElement("shaderMaterial",{uniforms:O,vertexShader:"\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n",blending:m.AdditiveBlending,depthTest:!1,transparent:!0,attach:"material"}))})),E=n(9),k=n(40),w=n(28),x=n(73),C=n.n(x),S=n(27),z=n(137),M=Object(S.a)((function(e){return{connected:!1,pingReceived:void 0,receivePing:function(){return e({connected:!0,pingReceived:new Date})},checkConnection:function(){return e((function(e){var t=e.pingReceived;return{connected:!!t&&Object(w.a)(new Date,t)<15e3}}))}}})),A=function(e,t){var n=t.scaledValue,r=t.receivedAt;return Object(w.a)(e,r)<45e3*n},I=function(e){return JSON.stringify({action:"sub",channel:e})},R=Object(S.a)((function(e){return{killmails:{},receiveKillmail:function(t){e((function(e){return{killmails:Object(k.a)({},e.killmails,Object(E.a)({},t.id,t))}}))},trimKillmails:function(){var t=A.bind(void 0,new Date);e((function(e){return{killmails:C()(e.killmails,t)}}))}}})),_=function(e){var t=M(Object(r.useCallback)((function(e){return e.receivePing}),[])),n=R(Object(r.useCallback)((function(e){return e.trimKillmails}),[])),a=R(Object(r.useCallback)((function(e){return e.receiveKillmail}),[]));Object(r.useEffect)((function(){var e=setInterval(n,5e3);return function(){return clearInterval(e)}}),[n]),Object(r.useEffect)((function(){var n=new WebSocket(e);return n.onopen=function(){n.send(I("killstream")),n.send(I("public"))},n.onmessage=function(e){var n=JSON.parse(e.data);"killmail_id"in n?a(function(e){var t=e.killmail_id,n=e.killmail_time,r=e.victim,a=e.solar_system_id,o=e.zkb,i=r.character_id,c=r.corporation_id,l=r.alliance_id,u=r.ship_type_id,s=o.url,f=o.totalValue;return{id:t,time:Object(z.a)(n),receivedAt:new Date,characterId:i,corporationId:c,allianceId:l,shipTypeId:u,solarSystemId:a,url:s,totalValue:f,scaledValue:F(f)}}(n)):"tqStatus"in n?t():console.error(n)},n.onclose=function(e){console.error(e)},function(){return n.close()}}),[e,a,t])},B=function(e,t){if(e<500)return m.MathUtils.smoothstep(e,0,500);var n=45e3*t,r=m.MathUtils.smoothstep(e,500,n)-1;return Math.pow(r,4)},F=function(e){var t=m.MathUtils.clamp(e,1e4,1e10);return m.MathUtils.mapLinear(t,1e4,1e10,1,10)},D=function(){var e=Object(s.g)().size,t=e.height,n=e.width;return Math.min(t,n)},V=function(e){var t=e.solarSystems,n=Object(r.useRef)(),o=Object(r.useContext)(l.a),i=D();return Object(s.e)((function(){if(n.current){for(var e=new m.Color(o.colorMaxSec),r=Object.values(t),a=r.length,c=i/75,l=d(a),u=l.positions,s=l.colors,f=l.scales,b=0;b<a;b++){var p=r[b];h(p,u,b),new m.Color(o.colorMinSec).lerp(e,p.security).toArray(s,3*b),f[b]=c*p.radius}v(n.current.geometry,u,s,f)}})),a.a.createElement(y,{ref:n})},N=function(e){var t=e.solarSystems,n=e.killmails,o=Object(r.useRef)(),i=Object(r.useContext)(l.a),c=D();return Object(s.e)((function(){if(n.current&&o.current){for(var e=n.current.length,r=new Date,a=c/8,l=new m.Color(i.flare),u=d(e),s=u.positions,f=u.colors,b=u.scales,p=0;p<n.current.length;p++){var g=n.current[p],j=g.receivedAt,O=g.solarSystemId,y=g.scaledValue,E=t[O]||{},k=Object(w.a)(r,j);b[p]=a*y*B(k,y),h(E,s,p),l.toArray(f,3*p)}v(o.current.geometry,s,f,b)}})),a.a.createElement(y,{ref:o})},P=n(8),T=n(80);function U(){var e=Object(c.a)(["\n  grid-area: ",";\n  text-decoration: none;\n"]);return U=function(){return e},e}function J(){var e=Object(c.a)(['\n  display: grid;\n  grid-template-areas: "ship character corporation alliance";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  padding-bottom: ","px;\n"]);return J=function(){return e},e}function K(){var e=Object(c.a)(["\n  overflow: hidden;\n  max-height: calc(100vh - ","px);\n  display: flex;\n  flex-flow: column;\n"]);return K=function(){return e},e}var G,L=l.e.div(K(),(function(e){return e.theme.unit})),q=Object(l.e)(T.a.div)(J(),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize}),(function(e){return e.theme.gapSize})),W=l.e.a(U(),(function(e){return e.area})),X=function(e){var t=e.src,n=e.area,r=e.href,o=e.height,i=e.size;return a.a.createElement(W,{href:r,area:n,target:"_blank"},a.a.createElement(T.a.img,{src:"".concat(t,"?size=").concat(i),style:{height:o,width:i},alt:""}))},Y=a.a.memo((function(e){var t=e.killmail,n=Object(r.useContext)(l.a).unit,o=t.characterId,i=t.corporationId,c=t.allianceId,u=t.shipTypeId,s=t.url,f=t.receivedAt,m=t.scaledValue,d=Object(T.b)((function(){return{opacity:0,height:0,paddingBottom:0}})),v=Object(P.a)(d,2),b=v[0],h=b.height,p=b.paddingBottom,g=b.opacity,j=v[1];return Object(r.useEffect)((function(){var e=n,t=n/8,r=function(){var n=Object(w.a)(new Date,f);if(n<500)j({opacity:1,height:e,paddingBottom:t,config:{duration:250}});else{var r=B(n,m);j(r>.1?{opacity:r,height:e,paddingBottom:t,config:{duration:1e3}}:{opacity:0,height:0,paddingBottom:0,config:{duration:250}})}},a=setInterval(r,1e3);return r(),function(){return clearInterval(a)}}),[j,f,m,n]),a.a.createElement(q,{style:{opacity:g,paddingBottom:p,gridAutoRows:h}},u&&a.a.createElement(X,{src:"https://images.evetech.net/types/".concat(u,"/render"),area:"ship",height:h,href:s,size:n}),o&&a.a.createElement(X,{src:"https://images.evetech.net/characters/".concat(o,"/portrait"),area:"character",height:h,href:"https://zkillboard.com/character/".concat(o,"/"),size:n}),i&&a.a.createElement(X,{src:"https://images.evetech.net/corporations/".concat(i,"/logo"),area:"corporation",height:h,href:"https://zkillboard.com/corporation/".concat(i,"/"),size:n}),c&&a.a.createElement(X,{src:"https://images.evetech.net/alliances/".concat(c,"/logo"),area:"alliance",height:h,href:"https://zkillboard.com/alliance/".concat(c,"/"),size:n}))})),H=function(e){var t=e.killmails.map((function(e){return a.a.createElement(Y,{killmail:e,key:e.id})}));return a.a.createElement(L,null,t)};!function(e){e[e.full=0]="full",e[e.follow=1]="follow"}(G||(G={}));var Q=Object(S.a)((function(e){return{cameraMode:G.full,showRegionNames:!1,setCameraMode:function(t){return e({cameraMode:t})},toggleRegionNames:function(){return e((function(e){return{showRegionNames:!e.showRegionNames}}))}}})),Z=n(55),$=n.n(Z),ee=n(129),te=n.n(ee),ne=Object(S.a)((function(e){return{systems:{},regions:{},loaded:!1,receive:function(t){var n=$()(t.regions,(function(e,t,n){var r=t.x,a=t.y,o=t.z,i=t.n;return e[n]={id:parseInt(n),x:r,y:o,z:a,name:i},e}),{}),r=$()(t.systems,(function(e,t,n){var r=t.x,a=t.y,o=t.z,i=t.n,c=t.r,l=t.s,u=t.p;return e[n]={id:parseInt(n),x:r,y:o,z:a,name:i,radius:te()(100*c,.5,1.5),security:l,regionId:u},e}),{});e({regions:n,systems:r,loaded:!0})}}})),re=function(e){return e.loaded},ae=function(e){return e.receive},oe=n(46);n(36),n(130);function ie(){var e=Object(c.a)(["\n  color: ",";\n  display: flex;\n  flex-flow: column;\n  gap: 1vh;\n"]);return ie=function(){return e},e}l.e.div(ie(),(function(e){return e.theme.text})),(new Date).getTime();var ce,le,ue,se=n(58);function fe(){var e=Object(c.a)(["\n  color: ",";\n  background: transparent;\n  border: none;\n  grid-area: ",";\n  cursor: ",";\n"]);return fe=function(){return e},e}function me(){var e=Object(c.a)(["\n  color: ",';\n  display: grid;\n  grid-template-areas: "fullscreen connection camera regions";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  direction: rtl;\n"]);return me=function(){return e},e}var de=l.e.div(me(),(function(e){return e.theme.text}),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize})),ve=l.e.button(fe(),(function(e){return e.theme.text}),(function(e){return e.area}),(function(e){return e.onClick?"pointer":"default"})),be=function(){var e=Object(r.useState)(!1),t=Object(P.a)(e,2),n=t[0],o=t[1];return a.a.createElement(ve,{type:"button",title:n?"Exit fullscreen":"Go fullscreen",onClick:function(){var e;n?document.exitFullscreen().then((function(){return o(!1)})):null===(e=document.getElementById("root"))||void 0===e||e.requestFullscreen().then((function(){return o(!0)}))},area:"fullscreen"},a.a.createElement(se.a,{icon:n?"compress-arrows-alt":"expand-arrows-alt"}))},he=function(){var e=M(Object(r.useCallback)((function(e){return e.connected}),[]));return a.a.createElement(ve,{type:"button",title:e?"Connected to live feed":"Disconnected from live feed!",area:"connection"},a.a.createElement(se.a,{icon:e?"link":"unlink"}))},pe=(ce={},Object(E.a)(ce,G.full,"globe"),Object(E.a)(ce,G.follow,"video"),ce),ge=(le={},Object(E.a)(le,G.full,G.follow),Object(E.a)(le,G.follow,G.full),le),je=(ue={},Object(E.a)(ue,G.full,"Camera: whole map"),Object(E.a)(ue,G.follow,"Camera: follow the action"),ue),Oe=function(){var e=Q(Object(r.useCallback)((function(e){return e.cameraMode}),[])),t=Q(Object(r.useCallback)((function(e){return e.setCameraMode}),[]));return a.a.createElement(ve,{type:"button",title:je[e],onClick:function(){t(ge[e])},area:"camera"},a.a.createElement(se.a,{icon:pe[e]}))},ye=function(){var e=Q(Object(r.useCallback)((function(e){return e.showRegionNames}),[])),t=Q(Object(r.useCallback)((function(e){return e.toggleRegionNames}),[]));return a.a.createElement(ve,{type:"button",title:e?"Region names shown":"Region names hidden",onClick:t,area:"regions"},a.a.createElement(se.a,{icon:e?"list-alt":"list"}))},Ee=function(){return a.a.createElement(de,null,a.a.createElement(be,null),a.a.createElement(he,null),a.a.createElement(Oe,null),a.a.createElement(ye,null))},ke=new m.Vector3(0,0,700),we=ke.z/3,xe=a.a.memo((function(e){var t=e.solarSystems,n=e.killmails,o=Q(Object(r.useCallback)((function(e){return e.cameraMode}),[])),i=Object(r.useRef)(),c=Object(r.useRef)(ke);return Object(r.useEffect)((function(){var e=Object.values(t);e.length>0&&(c.current=function(e){for(var t=e.length,n=new Float32Array(3*t),r=0;r<t;r++)h(e[r],n,r);var a=new m.BufferGeometry;if(a.setAttribute("position",new m.BufferAttribute(n,3)),a.computeBoundingSphere(),a.boundingSphere){var o=a.boundingSphere,i=o.center,c=o.radius;return i.z+=Math.max(1.1*c,we),i}return ke}(e),i.current&&i.current.position.lerp(c.current,1))}),[t]),Object(s.e)((function(){if(i.current&&c.current){var e,r=c.current,a=(null===(e=n.current)||void 0===e?void 0:e.length)||0;if(a>0&&o===G.follow){for(var l=new Date,u=-1/0,s=-1/0,f=-1/0,d=1/0,v=1/0,b=1/0,h=0,p=0,g=0,j=0,O=0;O<a;O++){var y=n.current[O],E=y.solarSystemId,k=y.scaledValue,x=y.receivedAt,C=t[E],S=C.x,z=C.y,M=C.z,A=Object(w.a)(l,x),I=k*B(A,k);if(I>.1){var R=I*S,_=I*z,F=I*M;u=Math.max(u,S),s=Math.max(s,z),f=Math.max(f,M),d=Math.min(d,S),v=Math.min(v,z),b=Math.min(b,M),h+=R,p+=_,g+=F,j+=I}}if(j>0){var D=h/j,V=p/j,N=g/j,P=Math.max(u-D,s-V,f-N,D-d,V-v,N-b,we);r=new m.Vector3(D,V,N+1.1*P)}}i.current.position.lerp(r,.01)}})),a.a.createElement(a.a.Fragment,null,a.a.createElement(oe.a,{ref:i,makeDefault:!0,near:.001,far:1e5,fov:90}))})),Ce=n(136),Se=n.n(Ce),ze=n(59),Me=function(){return a.a.createElement(ze.b,{multisampling:0},a.a.createElement(ze.a,{luminanceThreshold:.2,luminanceSmoothing:.9,intensity:3}),a.a.createElement(ze.c,{opacity:.04}),a.a.createElement(ze.d,{eskil:!1,offset:.1,darkness:1.1}))},Ae=Object(r.memo)((function(e){var t=e.solarSystems,n=Object(r.useContext)(l.a),o=Q(Object(r.useCallback)((function(e){return e.showRegionNames}),[])),i=ne(Object(r.useCallback)((function(e){for(var n=new Set,r=0,a=Object.values(t);r<a.length;r++){var o=a[r];n.add(o.regionId)}return Object.values(C()(e.regions,(function(e){return n.has(e.id)})))}),[t]));if(!o)return null;var c=i.map((function(e){var t=e.id,r=e.x,o=e.y,i=e.z,c=e.name,l=new m.Vector3(r,o,i);return a.a.createElement(oe.c,{anchorX:"center",anchorY:"middle",position:l,color:n.text,fontSize:n.regionFontSize,key:t},c)}));return a.a.createElement(a.a.Fragment,null,c)}));function Ie(){var e=Object(c.a)(["\n  position: absolute;\n  top: 1vmin;\n  right: 1vmin;\n"]);return Ie=function(){return e},e}function Re(){var e=Object(c.a)(["\n  position: absolute;\n  top: 1vmin;\n  left: 1vmin;\n"]);return Re=function(){return e},e}function _e(){var e=Object(c.a)(["\n  ","\n\n  #root {\n    height: 100vh;\n    background: ",";\n    overflow: hidden;\n  }\n\n  canvas {\n    outline: 0;\n  }\n"]);return _e=function(){return e},e}var Be=Object(l.c)(_e(),u.a,(function(e){return e.theme.background})),Fe=l.e.div(Re()),De=l.e.div(Ie()),Ve=Object(r.memo)((function(e){var t=e.solarSystems,n=e.killmails;return a.a.createElement(s.a,{onCreated:function(e){return e.gl.setClearColor(f.background)}},a.a.createElement(l.a.Provider,{value:f},a.a.createElement("ambientLight",null),a.a.createElement(V,{solarSystems:t}),a.a.createElement(N,{solarSystems:t,killmails:n}),a.a.createElement(Ae,{solarSystems:t}),a.a.createElement(xe,{solarSystems:t,killmails:n}),a.a.createElement(Me,null)))})),Ne=function(){_("wss://zkillboard.com/websocket/"),function(e){var t=ne(re),n=ne(ae);Object(r.useEffect)((function(){if(!t){var r=new AbortController;return fetch(e,{signal:r.signal}).then((function(e){return e.json()})).then(n),function(){return r.abort()}}}),[e,t,n])}("https://tmikoss.github.io/zkb-map/data/universe.json"),function(){var e=M(Object(r.useCallback)((function(e){return e.checkConnection}),[]));Object(r.useEffect)((function(){var t=setInterval(e,5e3);return function(){return clearInterval(t)}}),[e])}();var e=Object(r.useRef)([]),t=ne(Object(r.useCallback)((function(e){return e.systems}),[])),n=R(Object(r.useCallback)((function(e){var n=$()(e.killmails,(function(e,n){return t[n.solarSystemId]&&e.push(n),e}),[]);return Se()(n,"receivedAt").reverse()}),[t]));return Object(r.useEffect)((function(){e.current=n}),[n]),a.a.createElement(l.b,{theme:f},a.a.createElement(Be,null),a.a.createElement(Ve,{solarSystems:t,killmails:e}),a.a.createElement(Fe,null,a.a.createElement(H,{killmails:n})),a.a.createElement(De,null,a.a.createElement(Ee,null),!1))},Pe=n(56),Te=n(32);Pe.b.add(Te.a,Te.b,Te.d,Te.g,Te.h,Te.c,Te.e,Te.f);var Ue;Ue=Ne,i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Ue,null)),document.getElementById("root"))}},[[140,1,2]]]);
//# sourceMappingURL=main.050dbcc8.chunk.js.map
(this["webpackJsonpzkb-map"]=this["webpackJsonpzkb-map"]||[]).push([[0],{182:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),o=r(64),c=r.n(o),i=r(3),l=r(4),s=r(77),u=r(66),m=r(65),f=r.n(m),d=r(1),p=function(e){if(e<500)return d.MathUtils.smoothstep(e,0,500);var t=d.MathUtils.smoothstep(e,500,6e4)-1;return Math.pow(t,4)},v=function(e){var t=d.MathUtils.clamp(e,1e4,1e11);return d.MathUtils.mapLinear(t,1e4,1e11,.5,5)},b=JSON.stringify({action:"sub",channel:"killstream"});function h(e,t){switch(t.type){case"RECEIVE_WEBSOCKET":var r=t.payload,a=r.killmail_id,n=r.killmail_time,o=r.victim,c=r.solar_system_id,i=r.zkb,m={id:a,time:Object(s.a)(n),receivedAt:new Date,characterId:o.character_id,corporationId:o.corporation_id,allianceId:o.alliance_id,shipTypeId:o.ship_type_id,solarSystemId:c,url:i.url,totalValue:i.totalValue,scaledValue:v(i.totalValue)};return f()([m].concat(Object(l.a)(e)),"id");case"DECAY":var d=new Date;return e.filter((function(e){return Object(u.a)(d,e.receivedAt)<60}));default:return e}}var g=r(10),E=r(67);Object(g.b)({OrbitControls:E.a});var y=function(){var e=Object(g.d)(),t=e.camera,r=e.gl.domElement,o=Object(a.useRef)();return Object(g.c)((function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.update()})),n.a.createElement("orbitControls",{ref:o,args:[t,r]})},O=r(72),j=r.n(O),C=r(73),w=r.n(C),A=r(28),z=d.ImageUtils.loadTexture(j.a),k={color:{value:new d.Color},pointTexture:{value:z}},S=new d.Color("#2A9FD6"),x=new d.Color("#E6E6E6"),I=new d.Color("#E60000"),_=Object(a.forwardRef)((function(e,t){return n.a.createElement("points",{ref:t},n.a.createElement("bufferGeometry",{attach:"geometry"}),n.a.createElement("shaderMaterial",{uniforms:k,vertexShader:"\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n",blending:d.AdditiveBlending,depthTest:!1,transparent:!0,attach:"material"}))})),M=function(e){return{positions:new Float32Array(3*e),colors:new Float32Array(3*e),scales:new Float32Array(e)}},U=function(e,t,r,a){e.setAttribute("position",new d.BufferAttribute(t,3)),e.setAttribute("flareColor",new d.BufferAttribute(r,3)),e.setAttribute("size",new d.BufferAttribute(a,1)),e.attributes.position.needsUpdate=!0,e.attributes.flareColor.needsUpdate=!0,e.attributes.size.needsUpdate=!0},V=new d.Vector3,T=function(e){var t=e.x,r=e.y,a=e.z;return V.x=t,V.y=r,V.z=a,V},D=function(e){var t=e.solarSystems,r=Object(a.useRef)();return Object(a.useLayoutEffect)((function(){if(r.current){for(var e=t.length,a=M(e),n=a.positions,o=a.colors,c=a.scales,i=0;i<e;i++){var l=t[i];T(l).toArray(n,3*i),x.clone().lerp(S,l.security).toArray(o,3*i),c[i]=4}U(r.current.geometry,n,o,c)}}),[t]),n.a.createElement(_,{ref:r})},F=function(e){var t=e.solarSystems,r=e.killmails,o=Object(a.useRef)(),c=Object(a.useMemo)((function(){return w()(t,"id")}),[t]);return Object(g.c)((function(){if(r.current&&o.current){for(var e={},t=new Date,a=0;a<r.current.length;a++){var n=r.current[a],i=n.receivedAt,l=n.solarSystemId,s=n.scaledValue,u=Object(A.a)(t,i),m=150*s*p(u);e[l]=d.MathUtils.clamp((e[l]||0)+m,0,1e3)}for(var f=Object.keys(e),v=f.length,b=M(v),h=b.positions,g=b.colors,E=b.scales,y=0;y<v;y++){var O=f[y],j=c[O]||{};T(j).toArray(h,3*y),I.toArray(g,3*y),E[y]=e[O]}U(o.current.geometry,h,g,E)}})),n.a.createElement(_,{ref:o})},R=n.a.memo((function(e){var t=e.solarSystems,r=e.killmails;return n.a.createElement(g.a,{camera:{position:[0,0,1e3],near:.001,far:1e4},onCreated:function(e){return e.gl.setClearColor("#060606")}},n.a.createElement(D,{solarSystems:t}),n.a.createElement(F,{solarSystems:t,killmails:r}),n.a.createElement(y,null),n.a.createElement("ambientLight",null))})),B=r(40),P=r(41);function J(){var e=Object(B.a)(["\n  grid-area: data;\n"]);return J=function(){return e},e}function L(){var e=Object(B.a)(['\n  display: grid;\n  grid-template-areas: "ship character corporation data"\n                       "ship character alliance    data";\n  grid-template-columns: repeat(2, ',"px) ","px 1fr;\n  grid-template-rows: repeat(2, ","px);\n  grid-gap: ","px;\n"]);return L=function(){return e},e}var W=P.a.div(L(),128,64,64,8),K=P.a.pre(J()),N=function(e){var t=e.src,r=e.area,a=e.size;return n.a.createElement("img",{src:"".concat(t,"?size=").concat(a),style:{height:a,width:a,gridArea:r}})},Y=function(e){var t=e.killmail,r=t.characterId,a=t.corporationId,o=t.allianceId,c=t.totalValue,i=t.scaledValue,l=t.shipTypeId;return n.a.createElement(W,null,l&&n.a.createElement(N,{src:"https://images.evetech.net/types/".concat(l,"/render"),area:"ship",size:128}),r&&n.a.createElement(N,{src:"https://images.evetech.net/characters/".concat(r,"/portrait"),area:"character",size:128}),a&&n.a.createElement(N,{src:"https://images.evetech.net/corporations/".concat(a,"/logo"),area:"corporation",size:64}),o&&n.a.createElement(N,{src:"https://images.evetech.net/alliances/".concat(o,"/logo"),area:"alliance",size:64}),n.a.createElement(K,null,n.a.createElement("div",null,c),n.a.createElement("div",null,i)))},G=function(){var e=function(e){var t=e.sourceUrl,r=Object(a.useReducer)(h,[]),n=Object(i.a)(r,2),o=n[0],c=n[1];return Object(a.useEffect)((function(){var e=setInterval((function(){return c({type:"DECAY"})}),1e4);return function(){return clearInterval(e)}}),[c]),Object(a.useEffect)((function(){var e=new WebSocket(t);return e.onopen=function(){e.send(b)},e.onmessage=function(e){var t=JSON.parse(e.data);c({type:"RECEIVE_WEBSOCKET",payload:t})},function(){return e.close()}}),[t,c]),o}({sourceUrl:"wss://zkillboard.com/websocket/"}),t=function(){var e=Object(a.useState)([]),t=Object(i.a)(e,2),r=t[0],n=t[1];return Object(a.useEffect)((function(){fetch("data/solarSystems.json").then((function(e){return e.json()})).then((function(e){var t=Object.entries(e).map((function(e){var t=Object(i.a)(e,2),r=t[0],a=t[1],n=a.x,o=a.y,c=a.z,l=a.r,s=a.s,u=a.n;return{id:parseInt(r),x:n,y:c,z:o,name:u,radius:l,security:s}}));n(t)}))}),[]),r}(),r=Object(a.useRef)([]);return Object(a.useEffect)((function(){r.current=e}),[e]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{style:{height:600}},t.length>0&&n.a.createElement(R,{solarSystems:t,killmails:r})),e.map((function(e){return n.a.createElement(Y,{killmail:e,key:e.id})})))};c.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(G,null)),document.getElementById("root"))},72:function(e,t,r){e.exports=r.p+"static/media/glow.3b6b0c75.png"},78:function(e,t,r){e.exports=r(182)}},[[78,1,2]]]);
//# sourceMappingURL=main.15071f7a.chunk.js.map
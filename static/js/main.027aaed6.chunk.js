(this["webpackJsonpzkb-map"]=this["webpackJsonpzkb-map"]||[]).push([[0],{130:function(e,t,r){e.exports=r.p+"static/media/glow.3b6b0c75.png"},144:function(e,t,r){e.exports=r(260)},260:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),o=r(28),c=r.n(o),i=r(27),l=r(125),s=r(0),u=r(4),m=function(e){if(e<500)return s.MathUtils.smoothstep(e,0,500);var t=s.MathUtils.smoothstep(e,500,6e4)-1;return Math.pow(t,4)},f=function(e){var t=s.MathUtils.clamp(e,1e4,1e10);return s.MathUtils.mapLinear(t,1e4,1e10,1,10)},d=function(){var e=Object(u.h)().size,t=e.height,r=e.width;return Math.min(t,r)},p=r(34),v=r(56),b=r(19),h=r(16),g=r.n(h),y=r(29),j=r(123),O=r.n(j),E=Object(p.b)("solarSystems/fetch",Object(y.a)(g.a.mark((function e(){var t,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://tmikoss.github.io/zkb-map/data/solarSystems.json");case 2:return t=e.sent,e.next=5,t.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))),x=Object(p.c)({name:"solarSystems",initialState:{},reducers:{},extraReducers:function(e){e.addCase(E.fulfilled,(function(e,t){var r=t.payload;O()(r,(function(t,r){var n=t.x,a=t.y,o=t.z,c=t.n,i=t.r,l=t.s;e[r]={id:parseInt(r),x:n,y:o,z:a,name:c,radius:i,security:l}}))}))}}).reducer,k=r(124),w=r.n(k),S=r(140),C=Object(p.c)({name:"killmails",initialState:{},reducers:{receiveKillmail:function(e,t){var r=t.payload;e[r.id]=r},trimKillmailsBefore:function(e,t){var r=Object(S.a)(new Date,t.payload);return w()(e,(function(e){return e.receivedAt>r}))}}}),z=C.actions,A=z.receiveKillmail,_=z.trimKillmailsBefore,I=C.reducer,M=Object(b.c)({solarSystems:x,killmails:I}),P=Object(p.a)({reducer:M,middleware:Object(p.d)({serializableCheck:{ignoredActionPaths:["payload.time","payload.receivedAt"],ignoredPaths:["killmails"]},immutableCheck:!1})}),V=function(){return Object(v.b)()},T=v.c,B=P,D=JSON.stringify({action:"sub",channel:"killstream"});function F(e){var t=V();Object(n.useEffect)((function(){var e=setInterval((function(){t(_(60))}),1e4);return function(){return clearInterval(e)}}),[t]),Object(n.useEffect)((function(){var r=new WebSocket(e);return r.onopen=function(){r.send(D)},r.onmessage=function(e){t(A(function(e){var t=e.killmail_id,r=e.killmail_time,n=e.victim,a=e.solar_system_id,o=e.zkb;return{id:t,time:Object(l.a)(r),receivedAt:new Date,characterId:n.character_id,corporationId:n.corporation_id,allianceId:n.alliance_id,shipTypeId:n.ship_type_id,solarSystemId:a,url:o.url,totalValue:o.totalValue,scaledValue:f(o.totalValue)}}(JSON.parse(e.data))))},function(){return r.close()}}),[e,t])}var U=r(20),R=r(126),J=r(55);Object(u.e)({OrbitControls:J.b});var K=function(){var e=Object(u.h)(),t=e.camera,r=e.gl.domElement,o=Object(n.useRef)();return Object(u.f)((function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.update()})),a.a.createElement("orbitControls",{ref:o,args:[t,r]})},L={background:"#060606",colorMaxSec:"#2A9FD6",colorMinSec:"#E6E6E6",flare:"#E60000",text:"#E6E6E6"},N=a.a.createContext(L),G=function(e){return{positions:new Float32Array(3*e),colors:new Float32Array(3*e),scales:new Float32Array(e)}},W=function(e,t,r,n){e.setAttribute("position",new s.BufferAttribute(t,3)),e.setAttribute("flareColor",new s.BufferAttribute(r,3)),e.setAttribute("size",new s.BufferAttribute(n,1)),e.attributes.position.needsUpdate=!0,e.attributes.flareColor.needsUpdate=!0,e.attributes.size.needsUpdate=!0},q=new s.Vector3,H=function(e,t,r){var n=e.x,a=e.y,o=e.z;q.x=n,q.y=a,q.z=o,q.toArray(t,3*r)},Q=r(130),X=r.n(Q),Y=(new s.TextureLoader).load(X.a),Z={color:{value:new s.Color},pointTexture:{value:Y}},$=Object(n.forwardRef)((function(e,t){return a.a.createElement("points",{ref:t},a.a.createElement("bufferGeometry",{attach:"geometry"}),a.a.createElement("shaderMaterial",{uniforms:Z,vertexShader:"\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n",blending:s.AdditiveBlending,depthTest:!1,transparent:!0,attach:"material"}))})),ee=a.a.memo((function(e){var t=e.solarSystems,r=Object(n.useRef)(),o=Object(n.useContext)(N),c=d();return Object(u.f)((function(){if(r.current){for(var e=new s.Color(o.colorMaxSec),n=Object.values(t),a=n.length,i=c/90,l=G(a),u=l.positions,m=l.colors,f=l.scales,d=0;d<a;d++){var p=n[d];H(p,u,d),new s.Color(o.colorMinSec).lerp(e,p.security).toArray(m,3*d),f[d]=i}W(r.current.geometry,u,m,f)}})),a.a.createElement($,{ref:r})})),te=r(131),re=a.a.memo((function(e){var t=e.solarSystems,r=e.killmails,o=Object(n.useRef)(),c=Object(n.useContext)(N),i=d();return Object(u.f)((function(){if(r.current&&o.current){for(var e=r.current.length,n=new Date,a=i/8,l=new s.Color(c.flare),u=G(e),f=u.positions,d=u.colors,p=u.scales,v=0;v<r.current.length;v++){var b=r.current[v],h=b.receivedAt,g=b.solarSystemId,y=b.scaledValue,j=t[g]||{},O=Object(te.a)(n,h);p[v]=a*y*m(O),H(j,f,v),l.toArray(d,3*v)}W(o.current.geometry,f,d,p)}})),a.a.createElement($,{ref:o})})),ne=r(74),ae=r.n(ne),oe=r(84),ce=r.n(oe),ie=r(132),le=r.n(ie);function se(){var e=Object(i.a)(["\n  grid-area: ",";\n  text-decoration: none;\n"]);return se=function(){return e},e}function ue(){var e=Object(i.a)(["\n  grid-area: data;\n  color: ",";\n"]);return ue=function(){return e},e}function me(){var e=Object(i.a)(['\n  display: grid;\n  grid-template-areas: "ship character corporation alliance"\n                       "ship data      data        data";\n  grid-template-columns: ',"px ","px ","px 1fr;\n  grid-template-rows: repeat(2, ","px);\n  grid-gap: ","px;\n  animation: "," ","s linear;\n"]);return me=function(){return e},e}function fe(){var e=Object(i.a)(["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  overflow: hidden;\n  max-height: calc(100vh - ","px);\n"]);return fe=function(){return e},e}function de(){var e=Object(i.a)(["\n  0% { opacity: 0; }\n  0.5% { opacity: 1; }\n  10% { opacity: 0.9; }\n  50% { opacity: 0; }\n  100% { opacity: 0; }\n"]);return de=function(){return e},e}var pe=Object(U.d)(de()),ve=U.c.div(fe(),16,16,32),be=U.c.div(me(),64,32,32,32,4,pe,120),he=U.c.div(ue(),L.text),ge=U.c.a(se(),(function(e){return e.area})),ye=function(e){var t=e.src,r=e.area,n=e.size,o=e.href;return a.a.createElement(ge,{href:o,area:r,target:"_blank"},a.a.createElement("img",{src:"".concat(t,"?size=").concat(n),style:{height:n,width:n},alt:""}))},je=function(e){var t=e.killmail,r=e.solarSystem;if(!r)return null;var n,o=r.name,c=t.characterId,i=t.corporationId,l=t.allianceId,s=t.shipTypeId,u=t.totalValue,m=t.url;return a.a.createElement(be,null,s&&a.a.createElement(ye,{src:"https://images.evetech.net/types/".concat(s,"/render"),area:"ship",size:64,href:m}),c&&a.a.createElement(ye,{src:"https://images.evetech.net/characters/".concat(c,"/portrait"),area:"character",size:32,href:"https://zkillboard.com/character/".concat(c,"/")}),i&&a.a.createElement(ye,{src:"https://images.evetech.net/corporations/".concat(i,"/logo"),area:"corporation",size:32,href:"https://zkillboard.com/corporation/".concat(i,"/")}),l&&a.a.createElement(ye,{src:"https://images.evetech.net/alliances/".concat(l,"/logo"),area:"alliance",size:32,href:"https://zkillboard.com/alliance/".concat(l,"/")}),a.a.createElement(he,null,(n=u)>5e8?"".concat(ae()(n/1e9,1),"b"):n>5e5?"".concat(ae()(n/1e6,1),"m"):"".concat(ae()(n/1e3,1),"k")," @ ",o))},Oe=function(e){var t=e.killmails,r=e.solarSystems,n=le()(ce()(t),"receivedAt").reverse().map((function(e){var t=e.id,n=e.solarSystemId,o=r[n];return a.a.createElement(je,{killmail:e,solarSystem:o,key:t})}));return a.a.createElement(ve,null,n)};r(5),r(139),r(36),r(133);function Ee(){var e=Object(i.a)(["\n  position: absolute;\n  top: 1vh;\n  right: 1vw;\n  color: ",";\n  display: flex;\n  flex-flow: column;\n  gap: 1vh;\n"]);return Ee=function(){return e},e}U.c.div(Ee(),L.text),(new Date).getTime();function xe(){var e=Object(i.a)(["\n  ","\n\n  #root {\n    height: 100vh;\n    background: ",";\n    overflow: hidden;\n  }\n\n  canvas {\n    outline: 0;\n  }\n"]);return xe=function(){return e},e}var ke,we=Object(U.a)(xe(),R.a,L.background),Se={position:new s.Vector3(0,0,1e3),near:.001,far:1e4};ke=function(){var e=V();F("wss://zkillboard.com/websocket/"),Object(n.useEffect)((function(){e(E())}),[e]);var t=Object(n.useRef)([]),r=T((function(e){return e.solarSystems})),o=T((function(e){return e.killmails}));return Object(n.useEffect)((function(){t.current=Object.values(o)}),[o]),a.a.createElement(N.Provider,{value:L},a.a.createElement(we,null),a.a.createElement(u.a,{camera:Se,onCreated:function(e){return e.gl.setClearColor(L.background)}},a.a.createElement("ambientLight",null),a.a.createElement(ee,{solarSystems:r}),a.a.createElement(re,{solarSystems:r,killmails:t}),a.a.createElement(K,null)),a.a.createElement(Oe,{killmails:o,solarSystems:r}),!1)},c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(v.a,{store:B},a.a.createElement(ke,null))),document.getElementById("root"))}},[[144,1,2]]]);
//# sourceMappingURL=main.027aaed6.chunk.js.map
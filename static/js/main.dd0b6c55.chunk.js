(this["webpackJsonpzkb-map"]=this["webpackJsonpzkb-map"]||[]).push([[0],{123:function(e,t,n){e.exports=n.p+"static/media/glow.3b6b0c75.png"},140:function(e,t,n){e.exports=n(259)},259:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(38),i=n.n(o),c=n(23),l=n(19),u=n(119),s=n(10),f={background:"#060606",colorMaxSec:"#2A9FD6",colorMinSec:"#E6E6E6",flare:"#E60000",text:"#E6E6E6",unit:32,gapSize:8},m=n(0),d=function(e){return{positions:new Float32Array(3*e),colors:new Float32Array(3*e),scales:new Float32Array(e)}},v=function(e,t,n,r){e.setAttribute("position",new m.BufferAttribute(t,3)),e.setAttribute("flareColor",new m.BufferAttribute(n,3)),e.setAttribute("size",new m.BufferAttribute(r,1)),e.attributes.position.needsUpdate=!0,e.attributes.flareColor.needsUpdate=!0,e.attributes.size.needsUpdate=!0},b=new m.Vector3,h=function(e,t,n){var r=e.x,a=e.y,o=e.z;b.x=r,b.y=a,b.z=o,b.toArray(t,3*n)},p=n(123),g=n.n(p),j=(new m.TextureLoader).load(g.a),O={color:{value:new m.Color},pointTexture:{value:j}},y=Object(r.forwardRef)((function(e,t){return a.a.createElement("points",{ref:t},a.a.createElement("bufferGeometry",{attach:"geometry"}),a.a.createElement("shaderMaterial",{uniforms:O,vertexShader:"\n  attribute float size;\n  attribute vec3 flareColor;\n\n  varying vec3 vColor;\n\n  void main() {\n    vColor = flareColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = size * (300.0 / -mvPosition.z);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform vec3 color;\n  uniform sampler2D pointTexture;\n\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(color * vColor, 1.0);\n    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );\n  }\n",blending:m.AdditiveBlending,depthTest:!1,transparent:!0,attach:"material"}))})),E=function(e,t){if(e<500)return m.MathUtils.smoothstep(e,0,500);var n=45e3*t,r=m.MathUtils.smoothstep(e,500,n)-1;return Math.pow(r,4)},k=function(e){var t=m.MathUtils.clamp(e,1e4,1e10);return m.MathUtils.mapLinear(t,1e4,1e10,1,10)},w=function(){var e=Object(s.g)().size,t=e.height,n=e.width;return Math.min(t,n)},x=a.a.memo((function(e){var t=e.solarSystems,n=Object(r.useRef)(),o=Object(r.useContext)(l.a),i=w();return Object(s.e)((function(){if(n.current){for(var e=new m.Color(o.colorMaxSec),r=Object.values(t),a=r.length,c=i/75,l=d(a),u=l.positions,s=l.colors,f=l.scales,b=0;b<a;b++){var p=r[b];h(p,u,b),new m.Color(o.colorMinSec).lerp(e,p.security).toArray(s,3*b),f[b]=c*p.radius}v(n.current.geometry,u,s,f)}})),a.a.createElement(y,{ref:n})})),C=n(28),z=a.a.memo((function(e){var t=e.solarSystems,n=e.killmails,o=Object(r.useRef)(),i=Object(r.useContext)(l.a),c=w();return Object(s.e)((function(){if(n.current&&o.current){for(var e=n.current.length,r=new Date,a=c/8,l=new m.Color(i.flare),u=d(e),s=u.positions,f=u.colors,b=u.scales,p=0;p<n.current.length;p++){var g=n.current[p],j=g.receivedAt,O=g.solarSystemId,y=g.scaledValue,k=t[O]||{},w=Object(C.a)(r,j);b[p]=a*y*E(w,y),h(k,s,p),l.toArray(f,3*p)}v(o.current.geometry,s,f,b)}})),a.a.createElement(y,{ref:o})})),S=n(8),M=n(78);function A(){var e=Object(c.a)(["\n  grid-area: ",";\n  text-decoration: none;\n"]);return A=function(){return e},e}function I(){var e=Object(c.a)(['\n  display: grid;\n  grid-template-areas: "ship character corporation alliance";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  padding-bottom: ","px;\n"]);return I=function(){return e},e}function _(){var e=Object(c.a)(["\n  overflow: hidden;\n  max-height: calc(100vh - ","px);\n  display: flex;\n  flex-flow: column;\n"]);return _=function(){return e},e}var B,D=l.e.div(_(),(function(e){return e.theme.unit})),F=Object(l.e)(M.a.div)(I(),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize}),(function(e){return e.theme.gapSize})),V=l.e.a(A(),(function(e){return e.area})),R=function(e){var t=e.src,n=e.area,r=e.href,o=e.height,i=e.size;return a.a.createElement(V,{href:r,area:n,target:"_blank"},a.a.createElement(M.a.img,{src:"".concat(t,"?size=").concat(i),style:{height:o,width:i},alt:""}))},P=a.a.memo((function(e){var t=e.killmail,n=Object(r.useContext)(l.a).unit,o=t.characterId,i=t.corporationId,c=t.allianceId,u=t.shipTypeId,s=t.url,f=t.receivedAt,m=t.scaledValue,d=Object(M.b)((function(){return{opacity:0,height:0,paddingBottom:0}})),v=Object(S.a)(d,2),b=v[0],h=b.height,p=b.paddingBottom,g=b.opacity,j=v[1];return Object(r.useEffect)((function(){var e=n,t=n/8,r=function(){var n=Object(C.a)(new Date,f);if(n<500)j({opacity:1,height:e,paddingBottom:t,config:{duration:250}});else{var r=E(n,m);j(r>.1?{opacity:r,height:e,paddingBottom:t,config:{duration:1e3}}:{opacity:0,height:0,paddingBottom:0,config:{duration:250}})}},a=setInterval(r,1e3);return r(),function(){return clearInterval(a)}}),[j,f,m,n]),a.a.createElement(F,{style:{opacity:g,paddingBottom:p,gridAutoRows:h}},u&&a.a.createElement(R,{src:"https://images.evetech.net/types/".concat(u,"/render"),area:"ship",height:h,href:s,size:n}),o&&a.a.createElement(R,{src:"https://images.evetech.net/characters/".concat(o,"/portrait"),area:"character",height:h,href:"https://zkillboard.com/character/".concat(o,"/"),size:n}),i&&a.a.createElement(R,{src:"https://images.evetech.net/corporations/".concat(i,"/logo"),area:"corporation",height:h,href:"https://zkillboard.com/corporation/".concat(i,"/"),size:n}),c&&a.a.createElement(R,{src:"https://images.evetech.net/alliances/".concat(c,"/logo"),area:"alliance",height:h,href:"https://zkillboard.com/alliance/".concat(c,"/"),size:n}))})),T=function(e){var t=e.killmails.map((function(e){return a.a.createElement(P,{killmail:e,key:e.id})}));return a.a.createElement(D,null,t)},U=n(9),J=n(39),K=n(128),G=n.n(K),L=n(27),q=n(137),N=Object(L.a)((function(e){return{connected:!1,pingReceived:void 0,receivePing:function(){return e({connected:!0,pingReceived:new Date})},checkConnection:function(){return e((function(e){var t=e.pingReceived;return{connected:!!t&&Object(C.a)(new Date,t)<15e3}}))}}})),W=function(e,t){var n=t.scaledValue,r=t.receivedAt;return Object(C.a)(e,r)<45e3*n},H=function(e){return JSON.stringify({action:"sub",channel:e})},Q=Object(L.a)((function(e){return{killmails:{},receiveKillmail:function(t){e((function(e){return{killmails:Object(J.a)({},e.killmails,Object(U.a)({},t.id,t))}}))},trimKillmails:function(){var t=W.bind(void 0,new Date);e((function(e){return{killmails:G()(e.killmails,t)}}))}}})),X=function(e){var t=N(Object(r.useCallback)((function(e){return e.receivePing}),[])),n=Q(Object(r.useCallback)((function(e){return e.trimKillmails}),[])),a=Q(Object(r.useCallback)((function(e){return e.receiveKillmail}),[]));Object(r.useEffect)((function(){var e=setInterval(n,5e3);return function(){return clearInterval(e)}}),[n]),Object(r.useEffect)((function(){var n=new WebSocket(e);return n.onopen=function(){n.send(H("killstream")),n.send(H("public"))},n.onmessage=function(e){var n=JSON.parse(e.data);"killmail_id"in n?a(function(e){var t=e.killmail_id,n=e.killmail_time,r=e.victim,a=e.solar_system_id,o=e.zkb,i=r.character_id,c=r.corporation_id,l=r.alliance_id,u=r.ship_type_id,s=o.url,f=o.totalValue;return{id:t,time:Object(q.a)(n),receivedAt:new Date,characterId:i,corporationId:c,allianceId:l,shipTypeId:u,solarSystemId:a,url:s,totalValue:f,scaledValue:k(f)}}(n)):"tqStatus"in n?t():console.error(n)},n.onclose=function(e){console.error(e)},function(){return n.close()}}),[e,a,t])};!function(e){e[e.full=0]="full",e[e.follow=1]="follow"}(B||(B={}));var Y=Object(L.a)((function(e){return{cameraMode:B.full,setCameraMode:function(t){return e({cameraMode:t})}}})),Z=n(54),$=n.n(Z),ee=n(129),te=n.n(ee),ne=Object(L.a)((function(e){return{systems:{},regions:{},loaded:!1,receive:function(t){var n=$()(t.regions,(function(e,t,n){var r=t.x,a=t.y,o=t.z,i=t.n;return e[n]={id:parseInt(n),x:r,y:o,z:a,name:i},e}),{}),r=$()(t.systems,(function(e,t,n){var r=t.x,a=t.y,o=t.z,i=t.n,c=t.r,l=t.s,u=t.p;return e[n]={id:parseInt(n),x:r,y:o,z:a,name:i,radius:te()(100*c,.5,1.5),security:l,regionId:u},e}),{});e({regions:n,systems:r,loaded:!0})}}})),re=function(e){return e.loaded},ae=function(e){return e.receive},oe=n(75);n(35),n(130);function ie(){var e=Object(c.a)(["\n  color: ",";\n  display: flex;\n  flex-flow: column;\n  gap: 1vh;\n"]);return ie=function(){return e},e}l.e.div(ie(),(function(e){return e.theme.text})),(new Date).getTime();var ce,le,ue,se=n(79);function fe(){var e=Object(c.a)(["\n  color: ",";\n  background: transparent;\n  border: none;\n  grid-area: ",";\n  cursor: ",";\n"]);return fe=function(){return e},e}function me(){var e=Object(c.a)(["\n  color: ",';\n  display: grid;\n  grid-template-areas: "fullscreen connection camera";\n  grid-auto-columns: ',"px;\n  grid-auto-rows: ","px;\n  gap: ","px;\n  direction: rtl;\n"]);return me=function(){return e},e}var de=l.e.div(me(),(function(e){return e.theme.text}),(function(e){return e.theme.unit}),(function(e){return e.theme.unit}),(function(e){return e.theme.gapSize})),ve=l.e.button(fe(),(function(e){return e.theme.text}),(function(e){return e.area}),(function(e){return e.onClick?"pointer":"default"})),be=function(){var e=Object(r.useState)(!1),t=Object(S.a)(e,2),n=t[0],o=t[1];return a.a.createElement(ve,{type:"button",title:n?"Exit fullscreen":"Go fullscreen",onClick:function(){var e;n?document.exitFullscreen().then((function(){return o(!1)})):null===(e=document.getElementById("root"))||void 0===e||e.requestFullscreen().then((function(){return o(!0)}))},area:"fullscreen"},a.a.createElement(se.a,{icon:n?"compress-arrows-alt":"expand-arrows-alt"}))},he=function(){var e=N(Object(r.useCallback)((function(e){return e.connected}),[]));return a.a.createElement(ve,{type:"button",title:e?"Connected to live feed":"Disconnected from live feed!",area:"connection"},a.a.createElement(se.a,{icon:e?"link":"unlink"}))},pe=(ce={},Object(U.a)(ce,B.full,"globe"),Object(U.a)(ce,B.follow,"video"),ce),ge=(le={},Object(U.a)(le,B.full,B.follow),Object(U.a)(le,B.follow,B.full),le),je=(ue={},Object(U.a)(ue,B.full,"Camera: whole map"),Object(U.a)(ue,B.follow,"Camera: follow the action"),ue),Oe=function(){var e=Y(Object(r.useCallback)((function(e){return e.cameraMode}),[])),t=Y(Object(r.useCallback)((function(e){return e.setCameraMode}),[]));return a.a.createElement(ve,{type:"button",title:je[e],onClick:function(){t(ge[e])},area:"camera"},a.a.createElement(se.a,{icon:pe[e]}))},ye=function(){return a.a.createElement(de,null,a.a.createElement(be,null),a.a.createElement(he,null),a.a.createElement(Oe,null))},Ee=new m.Vector3(0,0,700),ke=Ee.z/3,we=a.a.memo((function(e){var t=e.solarSystems,n=e.killmails,o=Y(Object(r.useCallback)((function(e){return e.cameraMode}),[])),i=Object(r.useRef)(),c=Object(r.useRef)(Ee);return Object(r.useEffect)((function(){var e=Object.values(t);e.length>0&&(c.current=function(e){for(var t=e.length,n=new Float32Array(3*t),r=0;r<t;r++)h(e[r],n,r);var a=new m.BufferGeometry;if(a.setAttribute("position",new m.BufferAttribute(n,3)),a.computeBoundingSphere(),a.boundingSphere){var o=a.boundingSphere,i=o.center,c=o.radius;return i.z+=Math.max(1.1*c,ke),i}return Ee}(e),i.current&&i.current.position.lerp(c.current,1))}),[t]),Object(s.e)((function(){if(i.current&&c.current){var e,r=c.current,a=(null===(e=n.current)||void 0===e?void 0:e.length)||0;if(a>0&&o===B.follow){for(var l=new Date,u=-1/0,s=-1/0,f=-1/0,d=1/0,v=1/0,b=1/0,h=0,p=0,g=0,j=0,O=0;O<a;O++){var y=n.current[O],k=y.solarSystemId,w=y.scaledValue,x=y.receivedAt,z=t[k],S=z.x,M=z.y,A=z.z,I=Object(C.a)(l,x),_=w*E(I,w);if(_>.1){var D=_*S,F=_*M,V=_*A;u=Math.max(u,S),s=Math.max(s,M),f=Math.max(f,A),d=Math.min(d,S),v=Math.min(v,M),b=Math.min(b,A),h+=D,p+=F,g+=V,j+=_}}if(j>0){var R=h/j,P=p/j,T=g/j,U=Math.max(u-R,s-P,f-T,R-d,P-v,T-b,ke);r=new m.Vector3(R,P,T+1.1*U)}}i.current.position.lerp(r,.01)}})),a.a.createElement(a.a.Fragment,null,a.a.createElement(oe.a,{ref:i,makeDefault:!0,near:.001,far:1e5,fov:90}))})),xe=n(136),Ce=n.n(xe),ze=n(57),Se=function(){return a.a.createElement(ze.b,{multisampling:0},a.a.createElement(ze.a,{luminanceThreshold:.2,luminanceSmoothing:.9,intensity:3}),a.a.createElement(ze.c,{opacity:.04}),a.a.createElement(ze.d,{eskil:!1,offset:.1,darkness:1.1}))};function Me(){var e=Object(c.a)(["\n  position: absolute;\n  top: 1vmin;\n  right: 1vmin;\n"]);return Me=function(){return e},e}function Ae(){var e=Object(c.a)(["\n  position: absolute;\n  top: 1vmin;\n  left: 1vmin;\n"]);return Ae=function(){return e},e}function Ie(){var e=Object(c.a)(["\n  ","\n\n  #root {\n    height: 100vh;\n    background: ",";\n    overflow: hidden;\n  }\n\n  canvas {\n    outline: 0;\n  }\n"]);return Ie=function(){return e},e}var _e=Object(l.c)(Ie(),u.a,(function(e){return e.theme.background})),Be=l.e.div(Ae()),De=l.e.div(Me()),Fe=Object(r.memo)((function(e){var t=e.solarSystems,n=e.killmails;return a.a.createElement(s.a,{onCreated:function(e){return e.gl.setClearColor(f.background)}},a.a.createElement(l.a.Provider,{value:f},a.a.createElement("ambientLight",null),a.a.createElement(x,{solarSystems:t}),a.a.createElement(z,{solarSystems:t,killmails:n}),a.a.createElement(we,{solarSystems:t,killmails:n}),a.a.createElement(Se,null)))})),Ve=function(){X("wss://zkillboard.com/websocket/"),function(e){var t=ne(re),n=ne(ae);Object(r.useEffect)((function(){if(!t){var r=new AbortController;return fetch(e,{signal:r.signal}).then((function(e){return e.json()})).then(n),function(){return r.abort()}}}),[e,t,n])}("https://tmikoss.github.io/zkb-map/data/universe.json"),function(){var e=N(Object(r.useCallback)((function(e){return e.checkConnection}),[]));Object(r.useEffect)((function(){var t=setInterval(e,5e3);return function(){return clearInterval(t)}}),[e])}();var e=Object(r.useRef)([]),t=ne(Object(r.useCallback)((function(e){return e.systems}),[])),n=Q(Object(r.useCallback)((function(e){var n=$()(e.killmails,(function(e,n){return t[n.solarSystemId]&&e.push(n),e}),[]);return Ce()(n,"receivedAt").reverse()}),[t]));return Object(r.useEffect)((function(){e.current=n}),[n]),a.a.createElement(l.b,{theme:f},a.a.createElement(_e,null),a.a.createElement(Fe,{solarSystems:t,killmails:e}),a.a.createElement(Be,null,a.a.createElement(T,{killmails:n})),a.a.createElement(De,null,a.a.createElement(ye,null),!1))},Re=n(55),Pe=n(41);Re.b.add(Pe.a,Pe.b,Pe.d,Pe.e,Pe.f,Pe.c);var Te;Te=Ve,i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Te,null)),document.getElementById("root"))}},[[140,1,2]]]);
//# sourceMappingURL=main.dd0b6c55.chunk.js.map